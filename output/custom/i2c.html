
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up Custom C++ I2C devices with ESPHome.">
<meta name="keywords" content="C++, Custom">
<meta itemprop="name" content="Custom I²C Device">
<meta itemprop="description" content="Instructions for setting up Custom C++ I2C devices with ESPHome.">
<meta itemprop="image" content="https://esphome.io/_images/language-cpp.png">
<meta name="twitter:title" content="Custom I²C Device">
<meta name="twitter:image:src" content="https://esphome.io/_images/language-cpp.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up Custom C++ I2C devices with ESPHome.">
<meta property="og:title" content="Custom I²C Device">
<meta property="og:image" content="https://esphome.io/_images/language-cpp.png">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up Custom C++ I2C devices with ESPHome.">

    <title>Custom I²C Device &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/custom/i2c.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Custom SPI Device" href="spi.html" />
    <link rel="prev" title="Generic Custom Component" href="custom_component.html" />
  <link href="/pagefind/pagefind-modular-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="../_static/custom.css?hash=573f3103" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <link rel="me" href="https://fosstodon.org/@esphome">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo-text.svg" alt="Logo"/>
            </a></p><script src="/pagefind/pagefind-modular-ui.js"></script>
<div class="pagefind-ui__form" id="search"></div>
<div class="search-results" id="mobile-search-results"></div>
<script>
    let callbackAdded = null;

    window.addEventListener('DOMContentLoaded', (event) => {
        const std_target = document.getElementById("search-results");
        const mobile_target = document.getElementById("mobile-search-results");
        const inpel = document.getElementById("search");

        function showTarget() {
            var target = std_target;
            if (window.innerWidth <= 875) {
                target = mobile_target;
                std_target.style.display = "none";
            } else {
                mobile_target.style.display = "none";
            }
            target.style.display = "block";
            const rect = target.getBoundingClientRect();
            const height = window.innerHeight;
            target.style.width = "100%";
            target.style.height = "fit-content";
            target.style.maxHeight = (height - rect.top - 10) + "px";
            if (!callbackAdded) {
                callbackAdded = true;
                document.addEventListener('click', clickCallback);
            }
        }

        function hideTargets() {
            std_target.style.display = "none";
            mobile_target.style.display = "none";
            std_target.style.height = "0";
            mobile_target.style.height = "0";
            if (callbackAdded) {
                document.removeEventListener('click', clickCallback);
                callbackAdded = false;
            }
        }


        const instance = new PagefindModularUI.Instance({
            showSubResults: true,
            showImages: false,
            ranking: {
                pageLength: 0.0,
                termSaturation: 1.6,
                termFrequency: 0.4,
                termSimilarity: 6.0
            }
        });

        instance.add(new PagefindModularUI.Input({
            containerElement: "#search"
        }));

        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#search-results"
        }));
        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#mobile-search-results"
        }));

        const clickCallback = (event) => {
            const path = event.composedPath();
            if (path.includes(std_target) || path.includes(mobile_target) || path.includes(inpel))
                return;
            hideTargets();
        };
        if (std_target && mobile_target) {
            instance.on("results", (results) => {
                if (results.results.length) {
                    showTarget();
                } else {
                    hideTargets();
                }
            });
        }
    });
</script>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Custom I²C Device</a><ul>
<li><a class="reference internal" href="#i2c-write">I²C Write</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  <ul class="breadcrumbs">
  
      <li><a href="index.html">Custom</a> ➔</li>
      <li>Custom I²C Device</li>

  
  </ul>
  <div class="search-results" id="search-results"></div>


          <div class="body" role="main">
            
  <section id="custom-i2c-device">
<h1>Custom I²C Device<a class="headerlink" href="#custom-i2c-device" title="Permalink to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Custom components are deprecated, not recommended for new configurations and will be removed from ESPHome in a
future release. Please look at creating a real ESPHome component and “importing” it into your configuration with
<a class="reference internal" href="../components/external_components.html"><span class="doc">External Components</span></a>.</p>
<p>You can find some basic documentation on creating your own components at <a class="reference internal" href="../guides/contributing.html#contributing-to-esphome"><span class="std std-ref">Contributing to ESPHome</span></a>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While we try to keep the ESPHome YAML configuration options as stable as possible, the ESPHome API is less
stable. If something in the APIs needs to be changed in order for something else to work, we will do so.</p>
</div>
<p>Lots of devices communicate using the I²C protocol. If you want to integrate
a device into ESPHome that uses this protocol you can pretty much use almost
all Arduino-based code because the <code class="docutils literal notranslate"><span class="pre">Wire</span></code> library is also available in ESPHome.</p>
<p>See the other custom component guides for how to register components and make
them publish values.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esphome.h&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyCustomComponent</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">setup</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Initialize the device here. Usually Wire.begin() will be called in here,</span>
<span class="w">    </span><span class="c1">// though that call is unnecessary if you have an &#39;i2c:&#39; entry in your config</span>

<span class="w">    </span><span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">loop</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Example: write the value 0x42 to register 0x78 of device with address 0x21</span>
<span class="w">    </span><span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="mh">0x21</span><span class="p">);</span>
<span class="w">    </span><span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mh">0x78</span><span class="p">);</span>
<span class="w">    </span><span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mh">0x42</span><span class="p">);</span>
<span class="w">    </span><span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<section id="i2c-write">
<h2>I²C Write<a class="headerlink" href="#i2c-write" title="Permalink to this heading">¶</a></h2>
<p>It may be useful to write to a register via I²C using a numerical input. For example, the following yaml code snippet captures a user-supplied numerical input in the range 1–255 from the dashboard:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">number</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Input</span><span class="nv"> </span><span class="s">1&quot;</span>
<span class="w">    </span><span class="nt">optimistic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">min_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">max_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255</span>
<span class="w">    </span><span class="nt">initial_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">    </span><span class="nt">step</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">box</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">input_1</span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mdi:counter&quot;</span>
</pre></div>
</div>
<p>We want to write this number to a <code class="docutils literal notranslate"><span class="pre">REGISTER_ADDRESS</span></code> on the slave device via I²C. The Arduino-based looping code shown above is modified following the guidance in <a class="reference internal" href="../components/sensor/custom.html"><span class="doc">Custom Sensor Component</span></a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esphome.h&quot;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">I2C_ADDRESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x21</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">REGISTER_ADDRESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x78</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">POLLING_PERIOD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15000</span><span class="p">;</span><span class="w"> </span><span class="c1">//milliseconds</span>
<span class="kt">char</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"> </span><span class="c1">//Initial value of the register</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyCustomComponent</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">PollingComponent</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">MyCustomComponent</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">PollingComponent</span><span class="p">(</span><span class="n">POLLING_PERIOD</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">get_setup_priority</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">esphome</span><span class="o">::</span><span class="n">setup_priority</span><span class="o">::</span><span class="n">BUS</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">//Access I2C bus</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">setup</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//Add code here as needed</span>
<span class="w">    </span><span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">register_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">input_1</span><span class="p">).</span><span class="n">state</span><span class="p">;</span><span class="w"> </span><span class="c1">//Read the number set on the dashboard</span>
<span class="w">  </span><span class="c1">//Did the user change the input?</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">register_value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">temp</span><span class="p">){</span>
<span class="w">        </span><span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="n">I2C_ADDRESS</span><span class="p">);</span>
<span class="w">        </span><span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">REGISTER_ADDRESS</span><span class="p">);</span>
<span class="w">        </span><span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">register_value</span><span class="p">);</span>
<span class="w">        </span><span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span>
<span class="w">        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">register_value</span><span class="p">;</span><span class="w"> </span><span class="c1">//Swap in the new value</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Component</span></code> class has been replaced with <code class="docutils literal notranslate"><span class="pre">PollingComponent</span></code> and the free-running <code class="docutils literal notranslate"><span class="pre">loop()</span></code> is changed to the  <code class="docutils literal notranslate"><span class="pre">update()</span></code> method with period set by <code class="docutils literal notranslate"><span class="pre">POLLING_PERIOD</span></code>. The numerical value from the dashboard is accessed with its <code class="docutils literal notranslate"><span class="pre">id</span></code> tag and its state is set to the byte variable that we call <code class="docutils literal notranslate"><span class="pre">register_value</span></code>.  To prevent an I²C write on every iteration, the contents of the register are stored in <code class="docutils literal notranslate"><span class="pre">temp</span></code> and checked for a change. Configuring the hardware with <code class="docutils literal notranslate"><span class="pre">get_setup_priority()</span></code> is explained in <a class="reference internal" href="../components/sensor/custom.html"><span class="doc">Step 1</span></a>.</p>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/custom/i2c.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been released since you last visited this page: 2024.5.4 🎉
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2024.5.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2024.5");
    } else if (old !== "2024.5") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2024.5");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>