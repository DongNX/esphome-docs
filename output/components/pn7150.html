
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up PN7150 NFC tag readers and tags in ESPHome">
<meta name="keywords" content="PN7150, NFC, RFID">
<meta itemprop="name" content="PN7150 NFC">
<meta itemprop="description" content="Instructions for setting up PN7150 NFC tag readers and tags in ESPHome">
<meta itemprop="image" content="https://esphome.io/_images/pn7150.jpg">
<meta name="twitter:title" content="PN7150 NFC">
<meta name="twitter:image:src" content="https://esphome.io/_images/pn7150.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up PN7150 NFC tag readers and tags in ESPHome">
<meta property="og:title" content="PN7150 NFC">
<meta property="og:image" content="https://esphome.io/_images/pn7150.jpg">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up PN7150 NFC tag readers and tags in ESPHome">

    <title>PN7150 NFC &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/pn7150.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PN7160 NFC" href="pn7160.html" />
    <link rel="prev" title="PipSolar PV Inverter" href="pipsolar.html" />
  <link href="/pagefind/pagefind-modular-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="../_static/custom.css?hash=573f3103" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <link rel="me" href="https://fosstodon.org/@esphome">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo-text.svg" alt="Logo"/>
            </a></p><script src="/pagefind/pagefind-modular-ui.js"></script>
<div class="pagefind-ui__form" id="search"></div>
<div class="search-results" id="mobile-search-results"></div>
<script>
    let callbackAdded = null;

    window.addEventListener('DOMContentLoaded', (event) => {
        const std_target = document.getElementById("search-results");
        const mobile_target = document.getElementById("mobile-search-results");
        const inpel = document.getElementById("search");

        function showTarget() {
            var target = std_target;
            if (window.innerWidth <= 875) {
                target = mobile_target;
                std_target.style.display = "none";
            } else {
                mobile_target.style.display = "none";
            }
            target.style.display = "block";
            const rect = target.getBoundingClientRect();
            const height = window.innerHeight;
            target.style.width = "100%";
            target.style.height = "fit-content";
            target.style.maxHeight = (height - rect.top - 10) + "px";
            if (!callbackAdded) {
                callbackAdded = true;
                document.addEventListener('click', clickCallback);
            }
        }

        function hideTargets() {
            std_target.style.display = "none";
            mobile_target.style.display = "none";
            std_target.style.height = "0";
            mobile_target.style.height = "0";
            if (callbackAdded) {
                document.removeEventListener('click', clickCallback);
                callbackAdded = false;
            }
        }


        const instance = new PagefindModularUI.Instance({
            showSubResults: true,
            showImages: false,
            ranking: {
                pageLength: 0.0,
                termSaturation: 1.6,
                termFrequency: 0.4,
                termSimilarity: 6.0
            }
        });

        instance.add(new PagefindModularUI.Input({
            containerElement: "#search"
        }));

        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#search-results"
        }));
        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#mobile-search-results"
        }));

        const clickCallback = (event) => {
            const path = event.composedPath();
            if (path.includes(std_target) || path.includes(mobile_target) || path.includes(inpel))
                return;
            hideTargets();
        };
        if (std_target && mobile_target) {
            instance.on("results", (results) => {
                if (results.results.length) {
                    showTarget();
                } else {
                    hideTargets();
                }
            });
        }
    });
</script>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">PN7150 NFC</a><ul>
<li><a class="reference internal" href="#component-hub">Component/Hub</a><ul>
<li><a class="reference internal" href="#configuration-variables">Configuration variables:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actions">Actions</a><ul>
<li><a class="reference internal" href="#tag-set-clean-mode-action"><code class="docutils literal notranslate"><span class="pre">tag.set_clean_mode</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-set-format-mode-action"><code class="docutils literal notranslate"><span class="pre">tag.set_format_mode</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-set-read-mode-action"><code class="docutils literal notranslate"><span class="pre">tag.set_read_mode</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-set-write-message-action"><code class="docutils literal notranslate"><span class="pre">tag.set_write_message</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-set-write-mode-action"><code class="docutils literal notranslate"><span class="pre">tag.set_write_mode</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-set-emulation-message-action"><code class="docutils literal notranslate"><span class="pre">tag.set_emulation_message</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-emulation-off-action"><code class="docutils literal notranslate"><span class="pre">tag.emulation_off</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-emulation-on-action"><code class="docutils literal notranslate"><span class="pre">tag.emulation_on</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-polling-off-action"><code class="docutils literal notranslate"><span class="pre">tag.polling_off</span></code> Action</a></li>
<li><a class="reference internal" href="#tag-polling-on-action"><code class="docutils literal notranslate"><span class="pre">tag.polling_on</span></code> Action</a></li>
</ul>
</li>
<li><a class="reference internal" href="#triggers">Triggers</a><ul>
<li><a class="reference internal" href="#on-tag-trigger"><code class="docutils literal notranslate"><span class="pre">on_tag</span></code> Trigger</a></li>
<li><a class="reference internal" href="#on-tag-removed-trigger"><code class="docutils literal notranslate"><span class="pre">on_tag_removed</span></code> Trigger</a></li>
<li><a class="reference internal" href="#on-emulated-tag-scan-trigger"><code class="docutils literal notranslate"><span class="pre">on_emulated_tag_scan</span></code> Trigger</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ndef">NDEF</a><ul>
<li><a class="reference internal" href="#ndef-reading">NDEF Reading</a></li>
<li><a class="reference internal" href="#ndef-writing">NDEF Writing</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  <ul class="breadcrumbs">
  
      <li><a href="index.html">Components</a> ‚ûî</li>
      <li>PN7150 NFC</li>

  
  </ul>
  <div class="search-results" id="search-results"></div>


          <div class="body" role="main">
            
  <section id="pn7150-nfc">
<h1>PN7150 NFC<a class="headerlink" href="#pn7150-nfc" title="Permalink to this heading">¬∂</a></h1>
<section id="component-hub">
<span id="pn7150-component"></span><h2>Component/Hub<a class="headerlink" href="#component-hub" title="Permalink to this heading">¬∂</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">pn7150</span></code> component allows you to use PN7150 NFC controllers with ESPHome. This component is a global hub that
establishes a connection to the PN7150 via <a class="reference internal" href="i2c.html#i2c"><span class="std std-ref">I¬≤C</span></a>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/pn7150-full.jpg"><img alt="../_images/pn7150-full.jpg" src="../_images/pn7150-full.jpg" style="width: 70.0%;" /></a>
</figure>
<p>An <a class="reference internal" href="i2c.html#i2c"><span class="std std-ref">I¬≤C</span></a> bus must be defined within your device‚Äôs ESPHome configuration to use the PN7150.</p>
<p>ESPHome supports both card/tag reading/writing as well as card/tag emulation with this component. By default,
only read/write mode is enabled; card/tag emulation is enabled only if the <code class="docutils literal notranslate"><span class="pre">emulation_message</span></code> configuration
variable is defined (see below). Regardless, reader/writer (polling) mode and card/tag emulation mode may be
independently enabled and disabled by using the corresponding <a class="reference internal" href="#pn7150-actions"><span class="std std-ref">Actions</span></a> (see below).</p>
<p>In addition, the <a class="reference internal" href="binary_sensor/nfc.html"><span class="doc">NFC Binary Sensor</span></a> platform may be used to quickly and easily identify tags presented to the reader.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pn7150_i2c</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dwl_req_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GPIOXX</span>
<span class="w">  </span><span class="nt">irq_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GPIOXX</span>
<span class="w">  </span><span class="nt">ven_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GPIOXX</span>
<span class="w">  </span><span class="nt">wkup_req_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GPIOXX</span>
<span class="w">  </span><span class="nt">emulation_message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.home-assistant.io/tag/pulse_ce</span>
<span class="w">  </span><span class="nt">tag_ttl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000ms</span>
</pre></div>
</div>
<section id="configuration-variables">
<h3>Configuration variables:<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">¬∂</a></h3>
<ul class="simple">
<li><p><strong>dwl_req_pin</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-pin-schema"><span class="std std-ref">Pin Schema</span></a>): The pin connected to the PN7150‚Äôs
<code class="docutils literal notranslate"><span class="pre">DWL_REQ</span></code> line. Used to invoke the PN7150‚Äôs firmware update mode; may be used in a future release.</p></li>
<li><p><strong>irq_pin</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-pin-schema"><span class="std std-ref">Pin Schema</span></a>): The pin connected to the PN7150‚Äôs <code class="docutils literal notranslate"><span class="pre">IRQ</span></code> line.</p></li>
<li><p><strong>ven_pin</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-pin-schema"><span class="std std-ref">Pin Schema</span></a>): The pin connected to the PN7150‚Äôs <code class="docutils literal notranslate"><span class="pre">VEN</span></code> line.</p></li>
<li><p><strong>wkup_req_pin</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-pin-schema"><span class="std std-ref">Pin Schema</span></a>): The pin connected to the PN7150‚Äôs
<code class="docutils literal notranslate"><span class="pre">WKUP_REQ</span></code> line. May be used to improve power management in a future release.</p></li>
<li><p><strong>emulation_message</strong> (<em>Optional</em>, string): When scanned by another NFC card/tag reader (such as a smartphone), this
string is used as the content for an NDEF-formatted response. This allows the PN7150 to act as a tag in addition to a
tag reader/writer.</p></li>
<li><p><strong>tag_ttl</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The duration that must elapse after the PN7150 is no longer able to
‚Äúsee‚Äù a tag before it is considered to have been removed from the reader.</p></li>
<li><p><strong>on_tag</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/automations.html#automation"><span class="std std-ref">Automation</span></a>): An automation to perform when a tag is first read. See
<a class="reference internal" href="#pn7150-on-tag"><span class="std std-ref">on_tag Trigger</span></a>.</p></li>
<li><p><strong>on_tag_removed</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/automations.html#automation"><span class="std std-ref">Automation</span></a>): An automation to perform after a tag is removed. See
<a class="reference internal" href="#pn7150-on-tag-removed"><span class="std std-ref">on_tag_removed Trigger</span></a>.</p></li>
<li><p><strong>on_emulated_tag_scan</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/automations.html#automation"><span class="std std-ref">Automation</span></a>): An automation to perform when the PN7150 is
scanned by another tag reader (such as a smartphone). See <a class="reference internal" href="#pn7150-on-emulated-tag-scan"><span class="std std-ref">on_emulated_tag_scan Trigger</span></a>.</p></li>
<li><p><strong>i2c_id</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID of the <a class="reference internal" href="i2c.html#i2c"><span class="std std-ref">I¬≤C Component</span></a> if you need
to use multiple I¬≤C buses.</p></li>
<li><p><strong>id</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID for this component.</p></li>
</ul>
</section>
</section>
<section id="actions">
<span id="pn7150-actions"></span><h2>Actions<a class="headerlink" href="#actions" title="Permalink to this heading">¬∂</a></h2>
<section id="tag-set-clean-mode-action">
<span id="pn7150-set-clean-mode"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.set_clean_mode</span></code> Action<a class="headerlink" href="#tag-set-clean-mode-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to invoke ‚Äúclean mode‚Äù ‚Äì the next tag presented to the PN7150 will be ‚Äúcleaned‚Äù, removing all data
from the tag.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_clean_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
<section id="tag-set-format-mode-action">
<span id="pn7150-set-format-mode"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.set_format_mode</span></code> Action<a class="headerlink" href="#tag-set-format-mode-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to invoke ‚Äúformat mode‚Äù ‚Äì the next tag presented to the PN7150 will be ‚Äúformatted‚Äù, leaving only an
empty NDEF message structure on the tag.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_format_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
<section id="tag-set-read-mode-action">
<span id="pn7150-set-read-mode"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.set_read_mode</span></code> Action<a class="headerlink" href="#tag-set-read-mode-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to invoke ‚Äúread mode‚Äù ‚Äì the next tag presented to the PN7150 will be read. This is the default mode
that the component operates in.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_read_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
<section id="tag-set-write-message-action">
<span id="pn7150-set-write-message"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.set_write_message</span></code> Action<a class="headerlink" href="#tag-set-write-message-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to set the NDEF message used for ‚Äúwrite mode‚Äù (see below).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_write_message</span><span class="p">:</span>
<span class="w">        </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.home-assistant.io/tag/pulse</span>
<span class="w">        </span><span class="nt">include_android_app_record</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>message</strong> (<strong>Required</strong>, string, templatable): The string to include in the tag‚Äôs first NDEF record; typically
a URL as shown.</p></li>
<li><p><strong>include_android_app_record</strong> (<em>Optional</em>, boolean): Include a second NDEF record required for some Android
operating systems. Defaults to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
</ul>
</section>
<section id="tag-set-write-mode-action">
<span id="pn7150-set-write-mode"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.set_write_mode</span></code> Action<a class="headerlink" href="#tag-set-write-mode-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to invoke ‚Äúwrite mode‚Äù ‚Äì the next tag presented to the PN7150 will have its NDEF message set to the
message defined by the <code class="docutils literal notranslate"><span class="pre">tag.set_write_message</span></code> action (see above). <strong>Note that a message must be set before this mode
may be invoked.</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_write_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
<section id="tag-set-emulation-message-action">
<span id="pn7150-set-emulation-message"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.set_emulation_message</span></code> Action<a class="headerlink" href="#tag-set-emulation-message-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to set the NDEF message used for card (tag) emulation mode, when enabled (see below).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_emulation_message</span><span class="p">:</span>
<span class="w">        </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.home-assistant.io/tag/pulse</span>
<span class="w">        </span><span class="nt">include_android_app_record</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>message</strong> (<strong>Required</strong>, string, templatable): The string to include in the (emulated) tag‚Äôs first NDEF record;
typically a URL as shown.</p></li>
<li><p><strong>include_android_app_record</strong> (<em>Optional</em>, boolean): Include a second NDEF record required for some Android
operating systems. Defaults to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
</ul>
</section>
<section id="tag-emulation-off-action">
<span id="pn7150-emulation-off"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.emulation_off</span></code> Action<a class="headerlink" href="#tag-emulation-off-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to disable card (tag) emulation mode. The PN7150 will no longer respond to requests from other readers,
such as smartphones.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.emulation_off</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
<section id="tag-emulation-on-action">
<span id="pn7150-emulation-on"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.emulation_on</span></code> Action<a class="headerlink" href="#tag-emulation-on-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to enable card (tag) emulation mode. The PN7150 will respond to requests from other readers, such as
smartphones.</p>
<p><strong>Note:</strong> when card/tag emulation is enabled, polling (detecting a nearby card/tag) frequency is decreased; this
typically results in slightly slower detection of cards/tags presented to the PN7150. This behavior is normal and should
be expected; it is the result of the PN7150 toggling between polling and listening modes to support both functions.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.emulation_on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
<section id="tag-polling-off-action">
<span id="pn7150-polling-off"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.polling_off</span></code> Action<a class="headerlink" href="#tag-polling-off-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to disable card (tag) reading/writing. The PN7150 will no longer read or write cards/tags.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.polling_off</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
<section id="tag-polling-on-action">
<span id="pn7150-polling-on"></span><h3><code class="docutils literal notranslate"><span class="pre">tag.polling_on</span></code> Action<a class="headerlink" href="#tag-polling-on-action" title="Permalink to this heading">¬∂</a></h3>
<p>Use this action to enable card (tag) reading/writing. The PN7150 will read or write cards/tags.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.polling_on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
</section>
<section id="triggers">
<h2>Triggers<a class="headerlink" href="#triggers" title="Permalink to this heading">¬∂</a></h2>
<section id="on-tag-trigger">
<span id="pn7150-on-tag"></span><h3><code class="docutils literal notranslate"><span class="pre">on_tag</span></code> Trigger<a class="headerlink" href="#on-tag-trigger" title="Permalink to this heading">¬∂</a></h3>
<p>This automation will be triggered immediately after the PN7150 module identifies a tag and reads its NDEF
message (if one is present).</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">x</span></code> this trigger provides is of type <code class="docutils literal notranslate"><span class="pre">std::string</span></code> and is the tag UID in the format
<code class="docutils literal notranslate"><span class="pre">74-10-37-94</span></code>. The example configuration below will publish the tag ID on the MQTT topic <code class="docutils literal notranslate"><span class="pre">pn7150/tag</span></code>.</p>
<p>See <a class="reference internal" href="#pn7150-ndef-reading"><span class="std std-ref">NDEF Reading</span></a> below for how to use the second <code class="docutils literal notranslate"><span class="pre">tag</span></code> parameter that is provided to this trigger.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pn7150_i2c</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">on_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">then</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mqtt.publish</span><span class="p">:</span>
<span class="w">          </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pn7150/tag</span>
<span class="w">          </span><span class="nt">payload</span><span class="p">:</span><span class="w"> </span><span class="kt">!lambda</span><span class="w"> </span><span class="s">&#39;return</span><span class="nv"> </span><span class="s">x;&#39;</span>
</pre></div>
</div>
<p>A tag scanned event can also be sent to the Home Assistant tag component
using <a class="reference internal" href="api.html#api-homeassistant-tag-scanned-action"><span class="std std-ref">homeassistant.tag_scanned Action</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pn7150_i2c</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">on_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">then</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">homeassistant.tag_scanned</span><span class="p">:</span><span class="w"> </span><span class="kt">!lambda</span><span class="w"> </span><span class="s">&#39;return</span><span class="nv"> </span><span class="s">x;&#39;</span>
</pre></div>
</div>
<p>You could also send the value to Home Assistant via a <a class="reference internal" href="sensor/template.html"><span class="doc">template sensor</span></a>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pn7150_i2c</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">on_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">text_sensor.template.publish</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfc_tag</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="kt">!lambda</span><span class="w"> </span><span class="s">&#39;return</span><span class="nv"> </span><span class="s">x;&#39;</span>

<span class="nt">text_sensor</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NFC</span><span class="nv"> </span><span class="s">Tag&quot;</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nfc_tag</span>
</pre></div>
</div>
</section>
<section id="on-tag-removed-trigger">
<span id="pn7150-on-tag-removed"></span><h3><code class="docutils literal notranslate"><span class="pre">on_tag_removed</span></code> Trigger<a class="headerlink" href="#on-tag-removed-trigger" title="Permalink to this heading">¬∂</a></h3>
<p>This automation will be triggered after the <code class="docutils literal notranslate"><span class="pre">tag_ttl</span></code> interval (see above) when the PN7150 no longer ‚Äúsees‚Äù a
previously scanned tag.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">x</span></code> this trigger provides is of type <code class="docutils literal notranslate"><span class="pre">std::string</span></code> and is the removed tag UID in the format
<code class="docutils literal notranslate"><span class="pre">74-10-37-94</span></code>. The example configuration below will publish the removed tag ID on the MQTT topic <code class="docutils literal notranslate"><span class="pre">pn7150/tag_removed</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pn7150_i2c</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">on_tag_removed</span><span class="p">:</span>
<span class="w">    </span><span class="nt">then</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mqtt.publish</span><span class="p">:</span>
<span class="w">          </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pn7150/tag_removed</span>
<span class="w">          </span><span class="nt">payload</span><span class="p">:</span><span class="w"> </span><span class="kt">!lambda</span><span class="w"> </span><span class="s">&#39;return</span><span class="nv"> </span><span class="s">x;&#39;</span>
</pre></div>
</div>
</section>
<section id="on-emulated-tag-scan-trigger">
<span id="pn7150-on-emulated-tag-scan"></span><h3><code class="docutils literal notranslate"><span class="pre">on_emulated_tag_scan</span></code> Trigger<a class="headerlink" href="#on-emulated-tag-scan-trigger" title="Permalink to this heading">¬∂</a></h3>
<p>If card/tag emulation is enabled, this automation will be triggered when another reader (such as a smartphone) scans
the PN7150 and reads the NDEF message it responds with. No parameters are available to this action because data is only
sent <em>from</em> the PN7150 <em>to</em> the scanning device.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pn7150_i2c</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">on_emulated_tag_scan</span><span class="p">:</span>
<span class="w">    </span><span class="nt">then</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">rtttl.play</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alert:d=32,o=5,b=160:e6,p,e6,p,e6&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="ndef">
<span id="pn7150-ndef"></span><h1>NDEF<a class="headerlink" href="#ndef" title="Permalink to this heading">¬∂</a></h1>
<p>The PN7150 supports reading NDEF messages from and writing NDEF messages to cards/tags.</p>
<section id="ndef-reading">
<span id="pn7150-ndef-reading"></span><h2>NDEF Reading<a class="headerlink" href="#ndef-reading" title="Permalink to this heading">¬∂</a></h2>
<p>Given an NFC tag formatted and written using the Home Assistant Companion App, the following example will send the tag
ID contained within its NDEF message to Home Assistant using the <a class="reference internal" href="api.html#api-homeassistant-tag-scanned-action"><span class="std std-ref">homeassistant.tag_scanned Action</span></a>.
If no NDEF record is found with a tag ID, the tag‚Äôs UID will be sent to Home Assistant, instead.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">tag</span></code> variable is available to any actions that run within the <code class="docutils literal notranslate"><span class="pre">on_tag</span></code> and <code class="docutils literal notranslate"><span class="pre">on_tag_removed</span></code> triggers.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pn7150_i2c</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">on_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">then</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">homeassistant.tag_scanned</span><span class="p">:</span><span class="w"> </span><span class="kt">!lambda</span><span class="w"> </span><span class="s">&quot;return</span><span class="nv"> </span><span class="s">tag.has_ha_tag_id()</span><span class="nv"> </span><span class="s">?</span><span class="nv"> </span><span class="s">tag.get_ha_tag_id()</span><span class="nv"> </span><span class="s">:</span><span class="nv"> </span><span class="s">x;&quot;</span>
</pre></div>
</div>
</section>
<section id="ndef-writing">
<span id="pn7150-ndef-writing"></span><h2>NDEF Writing<a class="headerlink" href="#ndef-writing" title="Permalink to this heading">¬∂</a></h2>
<p>The examples below illustrate how NDEF messages may be written to cards/tags via the PN7150. Note that a
<a class="reference internal" href="button/index.html"><span class="doc">button</span></a> is a great mechanism to use to trigger these actions.</p>
<p>The first example will write a simple, fixed NDEF message to a tag.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">on_...</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">then</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_write_message</span><span class="p">:</span>
<span class="w">        </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://www.home-assistant.io/tag/pulse</span>
<span class="w">        </span><span class="nt">include_android_app_record</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">   </span><span class="c1"># optional</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_write_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
<p>The next example can be used to write a (pseudo) random UUID to a tag in the same manner as the Home Assistant
Companion App.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">on_...</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">then</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_write_message</span><span class="p">:</span>
<span class="w">        </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="kt">!lambda</span><span class="w"> </span><span class="s">&quot;return</span><span class="nv"> </span><span class="s">nfc::get_random_ha_tag_ndef();&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag.set_write_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_pn7150_id</span>
</pre></div>
</div>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¬∂</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="index.html"><span class="doc">Components</span></a></p></li>
<li><p><a class="reference internal" href="binary_sensor/pn532.html"><span class="doc">PN532 NFC/RFID</span></a></p></li>
<li><p><a class="reference internal" href="binary_sensor/rc522.html"><span class="doc">RC522 NFC/RFID</span></a></p></li>
<li><p><a class="reference internal" href="binary_sensor/rdm6300.html"><span class="doc">RDM6300 NFC/RFID</span></a></p></li>
<li><p><a class="reference external" href="/api/pn7150_8h.html">API Reference</a></p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/pn7150.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been released since you last visited this page: 2024.5.4 üéâ
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2024.5.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2024.5");
    } else if (old !== "2024.5") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2024.5");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>