
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up the Modbus Controller component.">
<meta itemprop="name" content="Modbus Controller">
<meta itemprop="description" content="Instructions for setting up the Modbus Controller component.">
<meta itemprop="image" content="https://esphome.io/_images/modbus.png">
<meta name="twitter:title" content="Modbus Controller">
<meta name="twitter:image:src" content="https://esphome.io/_images/modbus.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up the Modbus Controller component.">
<meta property="og:title" content="Modbus Controller">
<meta property="og:image" content="https://esphome.io/_images/modbus.png">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up the Modbus Controller component.">

    <title>Modbus Controller &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/modbus_controller.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MQTT Client Component" href="mqtt.html" />
    <link rel="prev" title="Modbus Component" href="modbus.html" />
  <link href="/pagefind/pagefind-modular-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="../_static/custom.css?hash=573f3103" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <link rel="me" href="https://fosstodon.org/@esphome">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo-text.svg" alt="Logo"/>
            </a></p><script src="/pagefind/pagefind-modular-ui.js"></script>
<div class="pagefind-ui__form" id="search"></div>
<div class="search-results" id="mobile-search-results"></div>
<script>
    let callbackAdded = null;

    window.addEventListener('DOMContentLoaded', (event) => {
        const std_target = document.getElementById("search-results");
        const mobile_target = document.getElementById("mobile-search-results");
        const inpel = document.getElementById("search");

        function showTarget() {
            var target = std_target;
            if (window.innerWidth <= 875) {
                target = mobile_target;
                std_target.style.display = "none";
            } else {
                mobile_target.style.display = "none";
            }
            target.style.display = "block";
            const rect = target.getBoundingClientRect();
            const height = window.innerHeight;
            target.style.width = "100%";
            target.style.height = "fit-content";
            target.style.maxHeight = (height - rect.top - 10) + "px";
            if (!callbackAdded) {
                callbackAdded = true;
                document.addEventListener('click', clickCallback);
            }
        }

        function hideTargets() {
            std_target.style.display = "none";
            mobile_target.style.display = "none";
            std_target.style.height = "0";
            mobile_target.style.height = "0";
            if (callbackAdded) {
                document.removeEventListener('click', clickCallback);
                callbackAdded = false;
            }
        }


        const instance = new PagefindModularUI.Instance({
            showSubResults: true,
            showImages: false,
            ranking: {
                pageLength: 0.0,
                termSaturation: 1.6,
                termFrequency: 0.4,
                termSimilarity: 6.0
            }
        });

        instance.add(new PagefindModularUI.Input({
            containerElement: "#search"
        }));

        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#search-results"
        }));
        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#mobile-search-results"
        }));

        const clickCallback = (event) => {
            const path = event.composedPath();
            if (path.includes(std_target) || path.includes(mobile_target) || path.includes(inpel))
                return;
            hideTargets();
        };
        if (std_target && mobile_target) {
            instance.on("results", (results) => {
                if (results.results.length) {
                    showTarget();
                } else {
                    hideTargets();
                }
            });
        }
    });
</script>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Modbus Controller</a><ul>
<li><a class="reference internal" href="#hardware-setup">Hardware setup</a></li>
<li><a class="reference internal" href="#configuration-variables">Configuration variables:</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#bitmasks">Bitmasks</a></li>
<li><a class="reference internal" href="#using-custom-command">Using <code class="docutils literal notranslate"><span class="pre">custom_command</span></code></a></li>
<li><a class="reference internal" href="#optimizing-modbus-communications">Optimizing modbus communications</a></li>
<li><a class="reference internal" href="#protocol-decoding-example">Protocol decoding example</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  <ul class="breadcrumbs">
  
      <li><a href="index.html">Components</a> ➔</li>
      <li>Modbus Controller</li>

  
  </ul>
  <div class="search-results" id="search-results"></div>


          <div class="body" role="main">
            
  <section id="modbus-controller">
<h1>Modbus Controller<a class="headerlink" href="#modbus-controller" title="Permalink to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> component creates a RS485 connection to control a Modbus server (slave) device, letting your ESPHome node to act as a Modbus client (master).
You can access the coils, inputs, holding, read registers from your devices as sensors, switches, selects, numbers or various other ESPHome components and present them to your favorite Home Automation system. You can even write them as binary or float ouptputs from ESPHome.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/modbus.png"><img alt="../_images/modbus.png" src="../_images/modbus.png" style="width: 25%;" /></a>
</figure>
<p>The <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> component relies on the <a class="reference internal" href="modbus.html"><span class="doc">Modbus Component</span></a>.</p>
<section id="hardware-setup">
<h2>Hardware setup<a class="headerlink" href="#hardware-setup" title="Permalink to this heading">¶</a></h2>
<p>You need an RS485 transceiver module:</p>
<figure class="align-default">
<img alt="../_images/rs485.jpg" src="../_images/rs485.jpg" />
</figure>
<p>See <a class="reference external" href="https://electronics.stackexchange.com/questions/244425/how-is-this-rs485-module-working">How is this RS485 module working?</a> on stackexchange for more details.</p>
<p>The transceiver connects to the UART of the MCU. For ESP32, pin <code class="docutils literal notranslate"><span class="pre">16</span></code> to <code class="docutils literal notranslate"><span class="pre">TXD</span></code> and pin <code class="docutils literal notranslate"><span class="pre">17</span></code> to <code class="docutils literal notranslate"><span class="pre">RXD</span></code> are the default ones but any other pins can be used as well. <code class="docutils literal notranslate"><span class="pre">3.3V</span></code> to <code class="docutils literal notranslate"><span class="pre">VCC</span></code> and naturally <code class="docutils literal notranslate"><span class="pre">GND</span></code> to <code class="docutils literal notranslate"><span class="pre">GND</span></code>.</p>
<p>On the bus side, you need 120 Ohm termination resistors at the ends of the bus cable as per Modbus standard. Some transceivers have this already soldered onboard, while some slave devices may have them available via a jumper or a DIP switch.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using an ESP8266, serial logging may cause problems reading from UART. For best results, hardware serial is recommended. Software serial may not be able to read all received data if other components spend a lot of time in the <code class="docutils literal notranslate"><span class="pre">loop()</span></code>.</p>
<p>For hardware serial only a limited set of pins can be used. Either <code class="docutils literal notranslate"><span class="pre">tx_pin:</span> <span class="pre">GPIO1</span></code> and <code class="docutils literal notranslate"><span class="pre">rx_pin:</span> <span class="pre">GPIO3</span></code>  or <code class="docutils literal notranslate"><span class="pre">tx_pin:</span> <span class="pre">GPIO15</span></code> and <code class="docutils literal notranslate"><span class="pre">rx_pin:</span> <span class="pre">GPIO13</span></code>.</p>
<p>The disadvantage of using the hardware UART is that you can’t use serial logging because the serial logs would be sent to the Modbus device(s) instead, causing errors.</p>
<p>Serial logging can be disabled by setting <code class="docutils literal notranslate"><span class="pre">baud_rate:</span> <span class="pre">0</span></code>.</p>
<p>See <a class="reference internal" href="logger.html"><span class="doc">Logger Component</span></a> for more details</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">logger</span><span class="p">:</span>
<span class="w">    </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;level&gt;</span>
<span class="w">    </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
</div>
</section>
<section id="configuration-variables">
<h2>Configuration variables:<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>modbus_id</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID of the <code class="docutils literal notranslate"><span class="pre">modbus</span></code> hub.</p></li>
<li><p><strong>address</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): The Modbus address of the slave device</p></li>
<li><p><strong>command_throttle</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): minimum time in between 2 requests to the device. Default is <code class="docutils literal notranslate"><span class="pre">0ms</span></code>.
Some Modbus slave devices limit the rate of requests from the master, so this allows the interval between requests to be altered.</p></li>
<li><p><strong>update_interval</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The interval that the sensors should be checked.
Defaults to 60 seconds.</p></li>
<li><p><strong>offline_skip_updates</strong> (<em>Optional</em>, integer): When a slave doesn’t respond to a command, it is
marked as offline, you can specify how many updates will be skipped while it is offline. If using a bus with multiple
slaves, this avoids waiting for timeouts allowing to read other slaves in the same bus. When the slave
responds to a command, it’ll be marked online again.</p></li>
</ul>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>The following code creates a <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> hub talking to a ModBUS device at address <code class="docutils literal notranslate"><span class="pre">1</span></code> with <code class="docutils literal notranslate"><span class="pre">115200</span></code> bps</p>
<p>ModBUS sensors can be directly defined (inline) under the <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> hub or as standalone components
Technically there is no difference between the “inline” and the standard definitions approach.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example configuration entry</span>
<span class="nt">uart</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="nt">modbus</span><span class="p">:</span>
<span class="w">  </span><span class="nt">flow_control_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GPIOXX</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus1</span>

<span class="nt">modbus_controller</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_device</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x1</span><span class="w">   </span><span class="c1">## address of the Modbus slave device on the bus</span>
<span class="w">  </span><span class="nt">modbus_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus1</span>
<span class="w">  </span><span class="nt">setup_priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-10</span>

<span class="nt">sensor</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_device</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Battery</span><span class="nv"> </span><span class="s">Capacity&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">holding</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x9001</span><span class="w">    </span><span class="c1">## address of the register inside the Modbus slave device</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AH&quot;</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>

<span class="nt">switch</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_device</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Reset</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Factory</span><span class="nv"> </span><span class="s">Default&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coil</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x15</span>
<span class="w">  </span><span class="nt">bitmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">text_sensor</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rtc_clock&quot;</span>
<span class="w">  </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_device</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rtc_clock</span>
<span class="w">  </span><span class="nt">internal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">holding</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x9013</span>
<span class="w">  </span><span class="nt">register_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">raw_encode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HEXBYTES</span>
<span class="w">  </span><span class="nt">response_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
</pre></div>
</div>
<p>The configuration example above creates a <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> hub talking to a Modbus device at address <code class="docutils literal notranslate"><span class="pre">1</span></code> with a baudrate of <code class="docutils literal notranslate"><span class="pre">115200</span></code> bps, implementing a sensor, a switch and a text sensor.</p>
<p>Check out the various Modbus components available at the bottom of the document in the <a class="reference internal" href="#modbusseealso"><span class="std std-ref">See Also</span></a> section. They can be directly defined <em>(inline)</em> under the <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> hub or as standalone components. Technically there is no difference between the <em>inline</em> and the standard definitions approach.</p>
<p>Below you find a few general tips about using Modbus in more advanced scenarios. Applicable component functionalities have links pointing here:</p>
</section>
<section id="bitmasks">
<span id="id1"></span><h2>Bitmasks<a class="headerlink" href="#bitmasks" title="Permalink to this heading">¶</a></h2>
<p>Some devices use decimal values in read registers to show multiple binary states occupying only one register address. To decode them, you can use bitmasks according to the table below. The decimal value corresponding to a bit is always double of the previous one in the row. Multiple bits can be represented in a single register by making a sum of all the values corresponding to the bits.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Alarm  bit</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>DEC value</p></th>
<th class="head"><p>HEX value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bit 0</p></td>
<td><p>Binary Sensor 0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>bit 1</p></td>
<td><p>Binary Sensor 1</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>bit 2</p></td>
<td><p>Binary Sensor 2</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>bit 3</p></td>
<td><p>Binary Sensor 3</p></td>
<td><p>8</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>bit 4</p></td>
<td><p>Binary Sensor 4</p></td>
<td><p>16</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>bit 5</p></td>
<td><p>Binary Sensor 5</p></td>
<td><p>32</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-even"><td><p>bit 6</p></td>
<td><p>Binary Sensor 6</p></td>
<td><p>64</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-odd"><td><p>bit 7</p></td>
<td><p>Binary Sensor 7</p></td>
<td><p>128</p></td>
<td><p>80</p></td>
</tr>
<tr class="row-even"><td><p>bit 8</p></td>
<td><p>Binary Sensor 8</p></td>
<td><p>256</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>bit 9</p></td>
<td><p>Binary Sensor 9</p></td>
<td><p>512</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-even"><td><p>bit 10</p></td>
<td><p>Binary Sensor 10</p></td>
<td><p>1024</p></td>
<td><p>400</p></td>
</tr>
<tr class="row-odd"><td><p>bit 11</p></td>
<td><p>Binary Sensor 11</p></td>
<td><p>2048</p></td>
<td><p>800</p></td>
</tr>
<tr class="row-even"><td><p>bit 12</p></td>
<td><p>Binary Sensor 12</p></td>
<td><p>4096</p></td>
<td><p>1000</p></td>
</tr>
<tr class="row-odd"><td><p>bit 13</p></td>
<td><p>Binary Sensor 13</p></td>
<td><p>8192</p></td>
<td><p>2000</p></td>
</tr>
<tr class="row-even"><td><p>bit 14</p></td>
<td><p>Binary Sensor 14</p></td>
<td><p>16384</p></td>
<td><p>4000</p></td>
</tr>
<tr class="row-odd"><td><p>bit 15</p></td>
<td><p>Binary Sensor 15</p></td>
<td><p>32768</p></td>
<td><p>8000</p></td>
</tr>
</tbody>
</table>
<p>In the example below, register <code class="docutils literal notranslate"><span class="pre">15</span></code>, holds several binary values. It stores the decimal value <code class="docutils literal notranslate"><span class="pre">12288</span></code>, which is the sum of <code class="docutils literal notranslate"><span class="pre">4096</span></code> + <code class="docutils literal notranslate"><span class="pre">8192</span></code>, meaning the corresponding bits <code class="docutils literal notranslate"><span class="pre">12</span></code> and <code class="docutils literal notranslate"><span class="pre">13</span></code> are <code class="docutils literal notranslate"><span class="pre">1</span></code>, the other bits are <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>To gather some of these bits as binary sensors in ESPHome, use <code class="docutils literal notranslate"><span class="pre">bitmask</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">binary_sensor</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus1</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Alarm bit0</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">  </span><span class="nt">bitmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x1</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus1</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Alarm bit1</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">  </span><span class="nt">bitmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x2</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus1</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Alarm bit10</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">  </span><span class="nt">bitmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x400</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus1</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Alarm bit15</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">  </span><span class="nt">bitmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x8000</span>
</pre></div>
</div>
</section>
<section id="using-custom-command">
<span id="modbus-custom-command"></span><h2>Using <code class="docutils literal notranslate"><span class="pre">custom_command</span></code><a class="headerlink" href="#using-custom-command" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">custom_command</span></code> can be used to create an arbitrary modbus command. Combined with a lambda any response can be handled.
This example re-implements the command to read the registers 0x156 (Total active energy) and 0x158 Total (reactive energy) from a SDM-120.
SDM-120 returns the values as floats using 32 bits in 2 registers.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">uart</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod_uart</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="nt">modbus</span><span class="p">:</span>
<span class="w">  </span><span class="nt">send_wait_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200ms</span>
<span class="w">  </span><span class="nt">uart_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod_uart</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod_bus</span>

<span class="nt">modbus_controller</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdm</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">modbus_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod_bus</span>
<span class="w">  </span><span class="nt">command_throttle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100ms</span>
<span class="w">  </span><span class="nt">setup_priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-10</span>
<span class="w">  </span><span class="nt">update_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>

<span class="nt">sensors</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdm</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Total</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">energy&quot;</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total_energy</span>
<span class="w">  </span><span class="c1">#    address: 0x156</span>
<span class="w">  </span><span class="c1">#    register_type: &quot;read&quot;</span>
<span class="w">  </span><span class="c1">## reimplement using custom_command</span>
<span class="w">  </span><span class="c1"># 0x2 : modbus device address</span>
<span class="w">  </span><span class="c1"># 0x4 : modbus function code</span>
<span class="w">  </span><span class="c1"># 0x1 : high byte of modbus register address</span>
<span class="w">  </span><span class="c1"># 0x56: low byte of modbus register address</span>
<span class="w">  </span><span class="c1"># 0x00: high byte of total number of registers requested</span>
<span class="w">  </span><span class="c1"># 0x02: low byte of total number of registers requested</span>
<span class="w">  </span><span class="nt">custom_command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">0x2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x4</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x56</span><span class="p p-Indicator">,</span><span class="nv">0x00</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x02</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FP32</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kWh</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sdm</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Total</span><span class="nv"> </span><span class="s">reactive</span><span class="nv"> </span><span class="s">energy&quot;</span>
<span class="w">  </span><span class="c1">#   address: 0x158</span>
<span class="w">  </span><span class="c1">#   register_type: &quot;read&quot;</span>
<span class="w">  </span><span class="nt">custom_command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0x2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x4</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x58</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x00</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0x02</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="c1">## the command returns an float value using 4 bytes</span>
<span class="w">  </span><span class="nt">lambda</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">ESP_LOGD(&quot;Modbus Sensor Lambda&quot;,&quot;Got new data&quot; );</span>
<span class="w">      </span><span class="no">union {</span>
<span class="w">        </span><span class="no">float float_value;</span>
<span class="w">        </span><span class="no">uint32_t raw;</span>
<span class="w">      </span><span class="no">} raw_to_float;</span>
<span class="w">      </span><span class="no">if (data.size() &lt; 4 ) {</span>
<span class="w">        </span><span class="no">ESP_LOGE(&quot;Modbus Sensor Lambda&quot;, &quot;invalid data size %d&quot;,data.size());</span>
<span class="w">        </span><span class="no">return NAN;</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">      </span><span class="no">raw_to_float.raw =   data[0] &lt;&lt; 24 | data[1] &lt;&lt; 16 | data[2] &lt;&lt; 8 |  data[3];</span>
<span class="w">      </span><span class="no">ESP_LOGD(&quot;Modbus Sensor Lambda&quot;, &quot;FP32 = 0x%08X =&gt; %f&quot;, raw_to_float.raw, raw_to_float.float_value);</span>
<span class="w">      </span><span class="no">return raw_to_float.float_value;</span>
<span class="w">    </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kVArh</span>
<span class="w">    </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
</section>
<section id="optimizing-modbus-communications">
<span id="modbus-register-count"></span><h2>Optimizing modbus communications<a class="headerlink" href="#optimizing-modbus-communications" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">register_count</span></code> is an option only required for uncommon response encodings or to optimizie modbus communications.</p>
<p>It describes the number of registers this data point spans, overriding the defaults determined by <code class="docutils literal notranslate"><span class="pre">value_type</span></code>. If no value for <code class="docutils literal notranslate"><span class="pre">register_count</span></code> is provided, it is calculated based on the register type. The default size for one register is 16 bits (one word). Some devices are not adhering to this convention and have registers larger than 16 bits. In this case, <code class="docutils literal notranslate"><span class="pre">register_count</span></code> and  <code class="docutils literal notranslate"><span class="pre">response_size</span></code> must be set. For example, if your Modbus device uses one register for a FP32 value (instead of the default of two), set <code class="docutils literal notranslate"><span class="pre">register_count:</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">response_size:</span> <span class="pre">4</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">register_count</span></code> can also be used to skip a number of registers in consecutive range.</p>
<p>An example is an SDM meter, with interesting data in register addresses 0, 2, 4 and 6:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Voltage</span><span class="nv"> </span><span class="s">Phase</span><span class="nv"> </span><span class="s">1&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;read&quot;</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FP32</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Voltage</span><span class="nv"> </span><span class="s">Phase</span><span class="nv"> </span><span class="s">2&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;read&quot;</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FP32</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Voltage</span><span class="nv"> </span><span class="s">Phase</span><span class="nv"> </span><span class="s">3&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;read&quot;</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FP32</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Current</span><span class="nv"> </span><span class="s">Phase</span><span class="nv"> </span><span class="s">1&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;read&quot;</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FP32</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>The configuration above will generate <em>one</em> modbus command <em>read multiple registers from 0 to 6</em>.</p>
<p>Maybe you don’t care about the data in register addresses 2 and 4, which are voltage values for Phase 2 and Phase 3 (or you have a SDM-120).
Of course, you can delete the sensors your don’t care about, but then you’d have a gap in the addresses. If you remove the registers at address 2 and 4, <em>two</em> commands will be generated – <em>read register 0</em> and <em>read register 6</em>. To avoid generating multiple commands and thus reduce activity on the bus, <code class="docutils literal notranslate"><span class="pre">register_count</span></code> can be used to fill the gaps:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Voltage</span><span class="nv"> </span><span class="s">Phase</span><span class="nv"> </span><span class="s">1&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;V&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;read&quot;</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FP32</span>
<span class="w">  </span><span class="nt">register_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Current</span><span class="nv"> </span><span class="s">Phase</span><span class="nv"> </span><span class="s">1&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;read&quot;</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FP32</span>
</pre></div>
</div>
<p>Because the option <code class="docutils literal notranslate"><span class="pre">register_count:</span> <span class="pre">6</span></code> is used for the first sensor, <em>one</em> command <em>read multiple registers from 0 to 6</em> will be used but the values in between will be ignored.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Calculation:</em> FP32 is a 32 bit value and uses 2 registers. Therefore, to skip the 2 FP32 registers the size of these 2 registers must be added to the default size for the first register. So we have 2 for address 0, 2 for address 2 and 2 for address 4 thus <code class="docutils literal notranslate"><span class="pre">register_count</span></code> must be 6.</p>
</div>
</section>
<section id="protocol-decoding-example">
<h2>Protocol decoding example<a class="headerlink" href="#protocol-decoding-example" title="Permalink to this heading">¶</a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">sensors</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array_rated_voltage</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;array_rated_voltage&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3000</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;V&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">skip_updates</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">  </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array_rated_current</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;array_rated_current&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3001</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;V&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array_rated_power</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;array_rated_power&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3002</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;W&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_DWORD_R</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">battery_rated_voltage</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;battery_rated_voltage&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3004</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;V&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">battery_rated_current</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;battery_rated_current&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3005</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">battery_rated_power</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;battery_rated_power&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3006</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;W&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_DWORD_R</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id: epever id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">charging_mode</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;charging_mode&quot;</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3008</span>
<span class="w">  </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">  </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">  </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>
</div>
<p>To minimize the required transactions all registers with the same base address are read in one request.
The response is mapped to the sensor based on <code class="docutils literal notranslate"><span class="pre">register_count</span></code> and offset in bytes. For example:</p>
<p><strong>Request</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>data</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x1  (01)</p></td>
<td><p>device address</p></td>
</tr>
<tr class="row-odd"><td><p>0x4  (04)</p></td>
<td><p>function code 4 (Read Input Registers)</p></td>
</tr>
<tr class="row-even"><td><p>0x30 (48)</p></td>
<td><p>start address high byte</p></td>
</tr>
<tr class="row-odd"><td><p>0x0  (00)</p></td>
<td><p>start address low byte</p></td>
</tr>
<tr class="row-even"><td><p>0x0  (00)</p></td>
<td><p>number of registers to read high byte</p></td>
</tr>
<tr class="row-odd"><td><p>0x9  (09)</p></td>
<td><p>number of registers to read low byte</p></td>
</tr>
<tr class="row-even"><td><p>0x3f (63)</p></td>
<td><p>crc</p></td>
</tr>
<tr class="row-odd"><td><p>0xc  (12)</p></td>
<td><p>crc</p></td>
</tr>
</tbody>
</table>
<p><strong>Response</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>offset</p></th>
<th class="head"><p>data</p></th>
<th class="head"><p>value (type)</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>H</p></td>
<td><p>0x1  (01)</p></td>
<td></td>
<td><p>device address</p></td>
</tr>
<tr class="row-odd"><td><p>H</p></td>
<td><p>0x4  (04)</p></td>
<td></td>
<td><p>function code</p></td>
</tr>
<tr class="row-even"><td><p>H</p></td>
<td><p>0x12 (18)</p></td>
<td></td>
<td><p>byte count</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>0x27 (39)</p></td>
<td><p>U_WORD</p></td>
<td><p>array_rated_voltage  high byte</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>0x10 (16)</p></td>
<td><p>0x2710 (100000)</p></td>
<td><p>array_rated_voltage  low byte</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>0x7  (7)</p></td>
<td><p>U_WORD</p></td>
<td><p>array_rated_current  high byte</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>0xd0 (208)</p></td>
<td><p>0x7d0 (2000)</p></td>
<td><p>array_rated_current  low byte</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>0xcb (203)</p></td>
<td><p>U_DWORD_R</p></td>
<td><p>array_rated_power high byte of low word</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>0x20 (32)</p></td>
<td><p>spans 2 register</p></td>
<td><p>array_rated_power low byte of low word</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>0x0  (0)</p></td>
<td></td>
<td><p>array_rated_power high byte of high word</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>0x0  (0)</p></td>
<td><p>0x0000CB20 (52000)</p></td>
<td><p>array_rated_power low byte of high word</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>0x9  (09)</p></td>
<td><p>U_WORD</p></td>
<td><p>battery_rated_voltage high byte</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>0x60 (96)</p></td>
<td><p>0x960 (2400)</p></td>
<td><p>battery_rated_voltage low byte</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>0x7  (07)</p></td>
<td><p>U_WORD</p></td>
<td><p>battery_rated_current high word</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>0xd0 (208)</p></td>
<td><p>0x7d0 (2000)</p></td>
<td><p>battery_rated_current high word</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>0xcb (203)</p></td>
<td><p>U_DWORD_R</p></td>
<td><p>battery_rated_power high byte of low word</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>0x20 (32)</p></td>
<td><p>spans 2 register</p></td>
<td><p>battery_rated_power low byte of low word</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>0x0  (0)</p></td>
<td></td>
<td><p>battery_rated_power high byte of high word</p></td>
</tr>
<tr class="row-even"><td><p>15</p></td>
<td><p>0x0  (0)</p></td>
<td><p>0x0000CB20 (52000)</p></td>
<td><p>battery_rated_power low byte of high word</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p>0x0  (0)</p></td>
<td><p>U_WORD</p></td>
<td><p>charging_mode high byte</p></td>
</tr>
<tr class="row-even"><td><p>17</p></td>
<td><p>0x2  (02)</p></td>
<td><p>0x2 (MPPT)</p></td>
<td><p>charging_mode low  byte</p></td>
</tr>
<tr class="row-odd"><td><p>C</p></td>
<td><p>0x2f (47)</p></td>
<td></td>
<td><p>crc</p></td>
</tr>
<tr class="row-even"><td><p>C</p></td>
<td><p>0x31 (49)</p></td>
<td></td>
<td><p>crc</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Write support is only implemented for switches and selects; however, the C++ code provides the required API to write to a Modbus device.</p>
<p>These methods can be called from a lambda.</p>
<p>Here is an example how to set config values to for an EPEVER Trace AN controller.
The code synchronizes the localtime of MCU to the epever controller
The time is set by writing 12 bytes to register 0x9013.
Then battery charge settings are sent.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">esphome</span><span class="p">:</span>
<span class="w">  </span><span class="nt">on_boot</span><span class="p">:</span>
<span class="w">    </span><span class="c1">## configure controller settings at setup</span>
<span class="w">    </span><span class="c1">## make sure priority is lower than setup_priority of modbus_controller</span>
<span class="w">    </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-100</span>
<span class="w">    </span><span class="nt">then</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">lambda</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">          </span><span class="no">// get local time and sync to controller</span>
<span class="w">          </span><span class="no">time_t now = ::time(nullptr);</span>
<span class="w">          </span><span class="no">struct tm *time_info = ::localtime(&amp;now);</span>
<span class="w">          </span><span class="no">int seconds = time_info-&gt;tm_sec;</span>
<span class="w">          </span><span class="no">int minutes = time_info-&gt;tm_min;</span>
<span class="w">          </span><span class="no">int hour = time_info-&gt;tm_hour;</span>
<span class="w">          </span><span class="no">int day = time_info-&gt;tm_mday;</span>
<span class="w">          </span><span class="no">int month = time_info-&gt;tm_mon + 1;</span>
<span class="w">          </span><span class="no">int year = time_info-&gt;tm_year % 100;</span>
<span class="w">          </span><span class="no">esphome::modbus_controller::ModbusController *controller = id(epever);</span>
<span class="w">          </span><span class="no">// if there is no internet connection localtime returns year 70</span>
<span class="w">          </span><span class="no">if (year != 70) {</span>
<span class="w">            </span><span class="no">// create the payload</span>
<span class="w">            </span><span class="no">std::vector&lt;uint16_t&gt; rtc_data = {uint16_t((minutes &lt;&lt; 8) | seconds), uint16_t((day &lt;&lt; 8) | hour),</span>
<span class="w">                                              </span><span class="no">uint16_t((year &lt;&lt; 8) | month)};</span>
<span class="w">            </span><span class="no">// Create a Modbus command item with the time information as the payload</span>
<span class="w">            </span><span class="no">esphome::modbus_controller::ModbusCommandItem set_rtc_command =</span>
<span class="w">                </span><span class="no">esphome::modbus_controller::ModbusCommandItem::create_write_multiple_command(controller, 0x9013, 3, rtc_data);</span>
<span class="w">            </span><span class="no">// Submit the command to the send queue</span>
<span class="w">            </span><span class="no">epever-&gt;queue_command(set_rtc_command);</span>
<span class="w">            </span><span class="no">ESP_LOGI(&quot;ModbusLambda&quot;, &quot;EPSOLAR RTC set to %02d:%02d:%02d %02d.%02d.%04d&quot;, hour, minutes, seconds, day, month,</span>
<span class="w">                    </span><span class="no">year + 2000);</span>
<span class="w">          </span><span class="no">}</span>
<span class="w">          </span><span class="no">// Battery settings</span>
<span class="w">          </span><span class="no">// Note: these values are examples only and apply my AGM Battery</span>
<span class="w">          </span><span class="no">std::vector&lt;uint16_t&gt; battery_settings1 = {</span>
<span class="w">              </span><span class="no">0,       // 9000 Battery Type 0 =  User</span>
<span class="w">              </span><span class="no">0x0073,  // 9001 Battery Cap 0x55 == 115AH</span>
<span class="w">              </span><span class="no">0x012C,  // 9002 Temp compensation -3V /°C/2V</span>
<span class="w">              </span><span class="no">0x05DC,  // 9003 0x5DC == 1500 Over Voltage Disconnect Voltage 15,0</span>
<span class="w">              </span><span class="no">0x058C,  // 9004 0x58C == 1480 Charging Limit Voltage 14,8</span>
<span class="w">              </span><span class="no">0x058C,  // 9005 Over Voltage Reconnect Voltage 14,8</span>
<span class="w">              </span><span class="no">0x05BF,  // 9006 Equalize Charging Voltage 14,6</span>
<span class="w">              </span><span class="no">0x05BE,  // 9007 Boost Charging Voltage 14,7</span>
<span class="w">              </span><span class="no">0x0550,  // 9008 Float Charging Voltage 13,6</span>
<span class="w">              </span><span class="no">0x0528,   // 9009 Boost Reconnect Charging Voltage 13,2</span>
<span class="w">              </span><span class="no">0x04C4,  // 900A Low Voltage Reconnect Voltage 12,2</span>
<span class="w">              </span><span class="no">0x04B0,  // 900B Under Voltage Warning Reconnect Voltage 12,0</span>
<span class="w">              </span><span class="no">0x04BA,  // 900c Under Volt. Warning Volt 12,1</span>
<span class="w">              </span><span class="no">0x04BA,  // 900d Low Volt. Disconnect Volt. 11.8</span>
<span class="w">              </span><span class="no">0x04BA   // 900E Discharging Limit Voltage 11.8</span>
<span class="w">          </span><span class="no">};</span>

<span class="w">          </span><span class="no">// Boost and equalization periods</span>
<span class="w">          </span><span class="no">std::vector&lt;uint16_t&gt; battery_settings2 = {</span>
<span class="w">              </span><span class="no">0x0000,  // 906B Equalize Duration (min.) 0</span>
<span class="w">              </span><span class="no">0x0075   // 906C Boost Duration (aka absorb) 117 mins</span>
<span class="w">          </span><span class="no">};</span>
<span class="w">          </span><span class="no">esphome::modbus_controller::ModbusCommandItem set_battery1_command =</span>
<span class="w">              </span><span class="no">esphome::modbus_controller::ModbusCommandItem::create_write_multiple_command(controller, 0x9000, battery_settings1.size() ,</span>
<span class="w">                                                                                          </span><span class="no">battery_settings1);</span>

<span class="w">          </span><span class="no">esphome::modbus_controller::ModbusCommandItem set_battery2_command =</span>
<span class="w">              </span><span class="no">esphome::modbus_controller::ModbusCommandItem::create_write_multiple_command(controller, 0x906B, battery_settings3.size(),</span>
<span class="w">                                                                                          </span><span class="no">battery_settings2);</span>
<span class="w">          </span><span class="no">delay(200) ;</span>
<span class="w">          </span><span class="no">controller-&gt;queue_command(set_battery1_command);</span>
<span class="w">          </span><span class="no">delay(200) ;</span>
<span class="w">          </span><span class="no">controller-&gt;queue_command(set_battery2_command);</span>
<span class="w">          </span><span class="no">ESP_LOGI(&quot;ModbusLambda&quot;, &quot;EPSOLAR Battery set&quot;);</span>

<span class="nt">uart</span><span class="p">:</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod_bus</span>
<span class="w">  </span><span class="nt">tx_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GPIOXX</span>
<span class="w">  </span><span class="nt">rx_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GPIOXX</span>
<span class="w">  </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">115200</span>
<span class="w">  </span><span class="nt">stop_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">modbus</span><span class="p">:</span>
<span class="w">  </span><span class="c1">#flow_control_pin: GPIOXX</span>
<span class="w">  </span><span class="nt">send_wait_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200ms</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod_bus_epever</span>

<span class="nt">modbus_controller</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">    </span><span class="c1">## the Modbus device addr</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x1</span>
<span class="w">    </span><span class="nt">modbus_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mod_bus_epever</span>
<span class="w">    </span><span class="nt">command_throttle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0ms</span>
<span class="w">    </span><span class="nt">setup_priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-10</span>
<span class="w">    </span><span class="nt">update_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${updates}</span>

<span class="nt">sensor</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">    </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array_rated_voltage</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;array_rated_voltage&quot;</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3000</span>
<span class="w">    </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;V&quot;</span>
<span class="w">    </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">    </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">    </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">    </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array_rated_current</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;array_rated_current&quot;</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3001</span>
<span class="w">    </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A&quot;</span>
<span class="w">    </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">    </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">    </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">    </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array_rated_power</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;array_rated_power&quot;</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x3002</span>
<span class="w">    </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;W&quot;</span>
<span class="w">    </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="w">    </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_DWORD_R</span>
<span class="w">    </span><span class="nt">accuracy_decimals</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>
</pre></div>
</div>
</div>
</section>
<section id="see-also">
<span id="modbusseealso"></span><h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="modbus.html"><span class="doc">Modbus Component</span></a></p></li>
<li><p><a class="reference internal" href="sensor/modbus_controller.html"><span class="doc">Modbus Controller Sensor</span></a></p></li>
<li><p><a class="reference internal" href="binary_sensor/modbus_controller.html"><span class="doc">Modbus Controller Binary Sensor</span></a></p></li>
<li><p><a class="reference internal" href="output/modbus_controller.html"><span class="doc">Modbus Controller Output</span></a></p></li>
<li><p><a class="reference internal" href="switch/modbus_controller.html"><span class="doc">Modbus Controller Switch</span></a></p></li>
<li><p><a class="reference internal" href="number/modbus_controller.html"><span class="doc">Modbus Controller Number</span></a></p></li>
<li><p><a class="reference internal" href="select/modbus_controller.html"><span class="doc">Modbus Controller Select</span></a></p></li>
<li><p><a class="reference internal" href="text_sensor/modbus_controller.html"><span class="doc">Modbus Controller Text Sensor</span></a></p></li>
<li><p><a class="reference external" href="https://www.modbustools.com/modbus.html">Modbus RTU Protocol Description</a></p></li>
<li><p><a class="reference external" href="https://devices.esphome.io/devices/epever_mptt_tracer_an">EPEVER MPPT Solar Charge Controller (Tracer-AN Series)</a></p></li>
<li><p><a class="reference external" href="https://devices.esphome.io/devices/Genvex-Nibe-AlphaInnotec-heat-recovery-ventilation">Genvex, Nibe, Alpha-Innotec heat recovery ventilation</a></p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/modbus_controller.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been released since you last visited this page: 2024.5.4 🎉
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2024.5.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2024.5");
    } else if (old !== "2024.5") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2024.5");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>