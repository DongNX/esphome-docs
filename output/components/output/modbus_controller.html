
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up a modbus_controller device output.">
<meta itemprop="name" content="Modbus Controller Output">
<meta itemprop="description" content="Instructions for setting up a modbus_controller device output.">
<meta name="twitter:title" content="Modbus Controller Output">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up a modbus_controller device output.">
<meta property="og:title" content="Modbus Controller Output">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up a modbus_controller device output.">

    <title>Modbus Controller Output &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../../_static/pygments_dark.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/output/modbus_controller.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MY9231/MY9291 LED driver" href="my9231.html" />
    <link rel="prev" title="MCP47A1 Output" href="mcp47a1.html" />
  <link href="/pagefind/pagefind-modular-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="../../_static/custom.css?hash=573f3103" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <link rel="me" href="https://fosstodon.org/@esphome">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo-text.svg" alt="Logo"/>
            </a></p><script src="/pagefind/pagefind-modular-ui.js"></script>
<div class="pagefind-ui__form" id="search"></div>
<div class="search-results" id="mobile-search-results"></div>
<script>
    let callbackAdded = null;

    window.addEventListener('DOMContentLoaded', (event) => {
        const std_target = document.getElementById("search-results");
        const mobile_target = document.getElementById("mobile-search-results");
        const inpel = document.getElementById("search");

        function showTarget() {
            var target = std_target;
            if (window.innerWidth <= 875) {
                target = mobile_target;
                std_target.style.display = "none";
            } else {
                mobile_target.style.display = "none";
            }
            target.style.display = "block";
            const rect = target.getBoundingClientRect();
            const height = window.innerHeight;
            target.style.width = "100%";
            target.style.height = "fit-content";
            target.style.maxHeight = (height - rect.top - 10) + "px";
            if (!callbackAdded) {
                callbackAdded = true;
                document.addEventListener('click', clickCallback);
            }
        }

        function hideTargets() {
            std_target.style.display = "none";
            mobile_target.style.display = "none";
            std_target.style.height = "0";
            mobile_target.style.height = "0";
            if (callbackAdded) {
                document.removeEventListener('click', clickCallback);
                callbackAdded = false;
            }
        }


        const instance = new PagefindModularUI.Instance({
            showSubResults: true,
            showImages: false,
            ranking: {
                pageLength: 0.0,
                termSaturation: 1.6,
                termFrequency: 0.4,
                termSimilarity: 6.0
            }
        });

        instance.add(new PagefindModularUI.Input({
            containerElement: "#search"
        }));

        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#search-results"
        }));
        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#mobile-search-results"
        }));

        const clickCallback = (event) => {
            const path = event.composedPath();
            if (path.includes(std_target) || path.includes(mobile_target) || path.includes(inpel))
                return;
            hideTargets();
        };
        if (std_target && mobile_target) {
            instance.on("results", (results) => {
                if (results.results.length) {
                    showTarget();
                } else {
                    hideTargets();
                }
            });
        }
    });
</script>
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Modbus Controller Output</a><ul>
<li><a class="reference internal" href="#configuration-variables">Configuration variables:</a></li>
<li><a class="reference internal" href="#example">Example:</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  <ul class="breadcrumbs">
  
      <li><a href="../index.html">Components</a> âž”</li>
      <li><a href="index.html">Output Component</a> âž”</li>
      <li>Modbus Controller Output</li>

  
  </ul>
  <div class="search-results" id="search-results"></div>


          <div class="body" role="main">
            
  <section id="modbus-controller-output">
<h1>Modbus Controller Output<a class="headerlink" href="#modbus-controller-output" title="Permalink to this heading">Â¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> platform creates an output from a modbus_controller. The goal is to write a value to a modbus register on a device.</p>
<section id="configuration-variables">
<h2>Configuration variables:<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">Â¶</a></h2>
<ul>
<li><p><strong>address</strong> (<strong>Required</strong>, int): start address of the first register in a range (can be decimal or hexadecimal).</p></li>
<li><p><strong>value_type</strong> (<strong>Required</strong>): data type of the modbus register data. The default data type for modbus is a 16 bit integer in big endian format (MSB first).</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">U_WORD</span></code> (unsigned 16 bit integer from 1 register = 16bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_WORD</span></code> (signed 16 bit integer from 1 register = 16bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_DWORD</span></code> (unsigned 32 bit integer from 2 registers = 32bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_DWORD</span></code> (signed 32 bit integer from 2 registers = 32bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_DWORD_R</span></code> (unsigned 32 bit integer from 2 registers low word first)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_DWORD_R</span></code> (signed 32 bit integer from 2 registers low word first)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_QWORD</span></code> (unsigned 64 bit integer from 4 registers = 64bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_QWORD</span></code> (signed 64 bit integer from 4 registers = 64bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_QWORD_R</span></code> (unsigned 64 bit integer from 4 registers low word first)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_QWORD_R</span></code> signed 64 bit integer from 4 registers low word first)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FP32</span></code> (32 bit IEEE 754 floating point from 2 registers)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FP32_R</span></code> (32 bit IEEE 754 floating point - same as FP32 but low word first)</p></li>
</ul>
</div></blockquote>
</li>
<li><dl class="simple">
<dt><strong>register_type</strong> (<em>Optional</em>):</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">coil</span></code>: Write Coil - Write the ON/OFF status of a discrete coil in the device with <em>Function Code 5 or 15</em>. This will create a binary output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">holding</span></code>: Write Holding Registers - write contents of holding registers in the device with <em>Function Code 6 or 16</em>. This will create a float output.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>multiply</strong> (<em>Optional</em>, float): multiply the incoming value with this factor before writing it to the device. Ignored if <code class="docutils literal notranslate"><span class="pre">write_lambda</span></code> is defined. Only valid for <code class="docutils literal notranslate"><span class="pre">register_type:</span> <span class="pre">holding</span></code>.</p></li>
<li><p><strong>use_write_multiple</strong> (<em>Optional</em>, boolean): By default the modbus command <em>Function Code 6 (Preset Single Registers)</em> is used for setting the holding register if only one register is set. If your device only supports <em>Function Code 16 (Preset Multiple Registers)</em> set this option to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p><strong>write_lambda</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/automations.html#config-lambda"><span class="std std-ref">lambda</span></a>):
Lambda is evaluated before the modbus write command is created. The value is passed in as <code class="docutils literal notranslate"><span class="pre">float</span> <span class="pre">x</span></code> and an empty vector is passed in as <code class="docutils literal notranslate"><span class="pre">std::vector&lt;uint16_t&gt;&amp;payload</span></code>.
You can directly define the payload by adding data to payload then the return value is ignored and the content of payload is used.</p>
<p>Parameters passed into the lambda</p>
<ul class="simple">
<li><p><strong>x</strong> (float or bool): The float value to be sent to the modbus device for <code class="docutils literal notranslate"><span class="pre">register_type:</span> <span class="pre">holding</span></code> or the boolean value to be sent to the modbus device for <code class="docutils literal notranslate"><span class="pre">register_type:</span> <span class="pre">coil</span></code></p></li>
<li><p><strong>payload</strong> (<code class="docutils literal notranslate"><span class="pre">`std::vector&lt;uint16_t&gt;&amp;payload`</span></code>):</p>
<ul>
<li><p>for <code class="docutils literal notranslate"><span class="pre">register_type:</span> <span class="pre">holding</span></code>: empty vector for the payload. The lamdba can add 16 bit raw modbus register words.</p></li>
<li><p>for <code class="docutils literal notranslate"><span class="pre">register_type:</span> <span class="pre">coil</span></code>: empty vector for the payload. If payload is set in the lambda it is sent as a custom command and must include all required bytes for a modbus request
note: because the response contains data for all registers in the same range you have to use <code class="docutils literal notranslate"><span class="pre">data[item-&gt;offset]</span></code> to get the first response byte for your sensor.</p></li>
</ul>
</li>
<li><p><strong>item</strong> (const pointer to a SensorItem derived object):  The sensor object itself.</p></li>
</ul>
<p>Possible return values for the lambda:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">&lt;FLOATING_POINT_NUMBER</span> <span class="pre">/</span> <span class="pre">BOOL&gt;;</span></code> the new value for the sensor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">&lt;anything&gt;;</span> <span class="pre">and</span> <span class="pre">fill</span> <span class="pre">payload</span> <span class="pre">with</span> <span class="pre">data</span></code> if the payload is added from the lambda then these 16 bit words will be sent</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">{};</span></code> if you donâ€™t want write the command to the device (or do it from the lambda).</p></li>
</ul>
</li>
<li><p><strong>offset</strong> (<em>Optional</em>, int): Offset from start address in bytes (only required for uncommon response encodings). If more than one register is written in a command this value is used to find the start of this datapoint relative to start address. The component calculates the size of the range based on offset and size of the value type.</p></li>
<li><p><strong>id</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID used for code generation.</p></li>
</ul>
<p>All other options from <a class="reference internal" href="index.html#config-output"><span class="std std-ref">Output</span></a>.</p>
</section>
<section id="example">
<h2>Example:<a class="headerlink" href="#example" title="Permalink to this heading">Â¶</a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">output</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">    </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus1</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2048</span>
<span class="w">    </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">holding</span>
<span class="w">    </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">    </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
</pre></div>
</div>
<p><strong>The same with lambda:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">output</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">    </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus1</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2048</span>
<span class="w">    </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">    </span><span class="nt">write_lambda</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">ESP_LOGD(&quot;main&quot;,&quot;Modbus Output incoming value = %f&quot;,x);</span>
<span class="w">      </span><span class="no">uint16_t value = x ;</span>
<span class="w">      </span><span class="no">payload.push_back(value);</span>
<span class="w">      </span><span class="no">return x * 1000 ;</span>
</pre></div>
</div>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">Â¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../modbus.html"><span class="doc">Modbus Component</span></a></p></li>
<li><p><a class="reference internal" href="../modbus_controller.html"><span class="doc">Modbus Controller</span></a></p></li>
<li><p><a class="reference internal" href="../sensor/modbus_controller.html"><span class="doc">Modbus Controller Sensor</span></a></p></li>
<li><p><a class="reference internal" href="../binary_sensor/modbus_controller.html"><span class="doc">Modbus Controller Binary Sensor</span></a></p></li>
<li><p><a class="reference internal" href="../switch/modbus_controller.html"><span class="doc">Modbus Controller Switch</span></a></p></li>
<li><p><a class="reference internal" href="../number/modbus_controller.html"><span class="doc">Modbus Controller Number</span></a></p></li>
<li><p><a class="reference internal" href="../select/modbus_controller.html"><span class="doc">Modbus Controller Select</span></a></p></li>
<li><p><a class="reference internal" href="../text_sensor/modbus_controller.html"><span class="doc">Modbus Controller Text Sensor</span></a></p></li>
<li><p><a class="reference external" href="https://www.modbustools.com/modbus.html">https://www.modbustools.com/modbus.html</a></p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/output/modbus_controller.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been released since you last visited this page: 2024.5.4 ðŸŽ‰
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2024.5.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2024.5");
    } else if (old !== "2024.5") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2024.5");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>