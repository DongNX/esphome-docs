
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up WeiKai SPI/I²C to UART Expanders in ESPHome.">
<meta name="keywords" content="UART, SPI, I²C, WK2132, WK2168, WK2204, WK2212, wk2124">
<meta itemprop="name" content="WeiKai SPI/I²C UART/IO Expander">
<meta itemprop="description" content="Instructions for setting up WeiKai SPI/I²C to UART Expanders in ESPHome.">
<meta itemprop="image" content="https://esphome.io/_images/wk2168.jpg">
<meta name="twitter:title" content="WeiKai SPI/I²C UART/IO Expander">
<meta name="twitter:image:src" content="https://esphome.io/_images/wk2168.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up WeiKai SPI/I²C to UART Expanders in ESPHome.">
<meta property="og:title" content="WeiKai SPI/I²C UART/IO Expander">
<meta property="og:image" content="https://esphome.io/_images/wk2168.jpg">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up WeiKai SPI/I²C to UART Expanders in ESPHome.">

    <title>WeiKai SPI/I²C UART/IO Expander &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/weikai.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Wiegand keypad and tag reader" href="wiegand.html" />
    <link rel="prev" title="Web Server Component" href="web_server.html" />
  <link href="/pagefind/pagefind-modular-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="../_static/custom.css?hash=573f3103" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <link rel="me" href="https://fosstodon.org/@esphome">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo-text.svg" alt="Logo"/>
            </a></p><script src="/pagefind/pagefind-modular-ui.js"></script>
<div class="pagefind-ui__form" id="search"></div>
<div class="search-results" id="mobile-search-results"></div>
<script>
    let callbackAdded = null;

    window.addEventListener('DOMContentLoaded', (event) => {
        const std_target = document.getElementById("search-results");
        const mobile_target = document.getElementById("mobile-search-results");
        const inpel = document.getElementById("search");

        function showTarget() {
            var target = std_target;
            if (window.innerWidth <= 875) {
                target = mobile_target;
                std_target.style.display = "none";
            } else {
                mobile_target.style.display = "none";
            }
            target.style.display = "block";
            const rect = target.getBoundingClientRect();
            const height = window.innerHeight;
            target.style.width = "100%";
            target.style.height = "fit-content";
            target.style.maxHeight = (height - rect.top - 10) + "px";
            if (!callbackAdded) {
                callbackAdded = true;
                document.addEventListener('click', clickCallback);
            }
        }

        function hideTargets() {
            std_target.style.display = "none";
            mobile_target.style.display = "none";
            std_target.style.height = "0";
            mobile_target.style.height = "0";
            if (callbackAdded) {
                document.removeEventListener('click', clickCallback);
                callbackAdded = false;
            }
        }


        const instance = new PagefindModularUI.Instance({
            showSubResults: true,
            showImages: false,
            ranking: {
                pageLength: 0.0,
                termSaturation: 1.6,
                termFrequency: 0.4,
                termSimilarity: 6.0
            }
        });

        instance.add(new PagefindModularUI.Input({
            containerElement: "#search"
        }));

        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#search-results"
        }));
        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#mobile-search-results"
        }));

        const clickCallback = (event) => {
            const path = event.composedPath();
            if (path.includes(std_target) || path.includes(mobile_target) || path.includes(inpel))
                return;
            hideTargets();
        };
        if (std_target && mobile_target) {
            instance.on("results", (results) => {
                if (results.results.length) {
                    showTarget();
                } else {
                    hideTargets();
                }
            });
        }
    });
</script>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">WeiKai SPI/I²C UART/IO Expander</a><ul>
<li><a class="reference internal" href="#connecting-via-an-spi-bus">Connecting via an SPI bus</a><ul>
<li><a class="reference internal" href="#configuration-variables">Configuration variables:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#connecting-via-an-i2c-bus">Connecting via an I²C bus</a><ul>
<li><a class="reference internal" href="#id1">Configuration variables:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-gpio-pins">Using the GPIO pins</a><ul>
<li><a class="reference internal" href="#pin-configuration-variables">Pin configuration variables:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-considerations">Performance considerations:</a><ul>
<li><a class="reference internal" href="#bus-speed">Bus speed</a></li>
<li><a class="reference internal" href="#maximum-baud-rate">Maximum Baud rate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  <ul class="breadcrumbs">
  
      <li><a href="index.html">Components</a> ➔</li>
      <li>WeiKai SPI/I²C UART/IO Expander</li>

  
  </ul>
  <div class="search-results" id="search-results"></div>


          <div class="body" role="main">
            
  <section id="weikai-spi-i2c-uart-io-expander">
<h1>WeiKai SPI/I²C UART/IO Expander<a class="headerlink" href="#weikai-spi-i2c-uart-io-expander" title="Permalink to this heading">¶</a></h1>
<p><strong>WeiKai Microelectronics</strong> provides a family of UART &amp; GPIO expansion chips
that interfaces to a micro-controller through SPI or I²C bus.</p>
<p>The ESPHome <code class="docutils literal notranslate"><span class="pre">WeiKai</span></code> component supports the following WeiKai chips:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://jlcpcb.com/partdetail/WEIKAI-WK2168IQPG/C401041">WK2168-IQPG</a></p></li>
<li><p><a class="reference external" href="https://jlcpcb.com/partdetail/WeiKai-WK2132ISSG/C401039">WK2132-ISSG</a></p></li>
<li><p><a class="reference external" href="https://jlcpcb.com/partdetail/WeiKai-WK2124ISSG/C86332">WK2124-ISSG</a></p></li>
<li><p><a class="reference external" href="https://jlcpcb.com/partdetail/WeiKai-WK2204IQNG/C401040">WK2204-IQNG</a></p></li>
<li><p><a class="reference external" href="https://jlcpcb.com/partdetail/WeiKai-WK2212IQNG/C2987671">WK2212-IQNG</a></p></li>
</ul>
<p>It can also be used with evaluation board equipped with these chips, such as:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://fr.aliexpress.com/item/1005002198759633.html">WK2168 Chip Development Board</a></p></li>
<li><p><a class="reference external" href="https://www.aliexpress.com/item/1005002018579265.html">WK2132 Chip Development Board</a></p></li>
<li><p><a class="reference external" href="https://www.dfrobot.com/product-2001.html">DFROBOT Gravity: I²C to Dual UART Module</a></p></li>
</ul>
<figure class="align-center">
<img alt="../_images/DFR0627.jpg" src="../_images/DFR0627.jpg" />
</figure>
<p>The features provided by the different WeiKai chips are described in the following table:</p>
<table class="docutils align-center" id="id2" style="width: 450px">
<caption><span class="caption-text">WeiKai chip’s features</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Chip</p></th>
<th class="head"><p>Bus</p></th>
<th class="head"><p>UART</p></th>
<th class="head"><p>GPIO</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WK2132-ISSG</p></td>
<td><p>S/I</p></td>
<td><p>2</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>WK2212-IQNG</p></td>
<td><p>S/I</p></td>
<td><p>2</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>WK2124-ISSG</p></td>
<td><p>S</p></td>
<td><p>4</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>WK2204-IQNG</p></td>
<td><p>S/I</p></td>
<td><p>4</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>WK2168-IQPG</p></td>
<td><p>S/I</p></td>
<td><p>4</p></td>
<td><p>8</p></td>
</tr>
</tbody>
</table>
<p>As you can see most of the components can interface either through an I²C bus or a SPI bus,
they provide either 2 or 4 serial channels, and some provide 8 input/output pins.</p>
<p>Each UART channel has two independent 256-byte FIFO hardware buffers to transmit and
receive and support data transmission rates up to 1 Mbps.
The baud rate and parity format of each UART channel can be configured independently.
However, the data bit length is fixed at 8.</p>
<p>Utilizing the UART channels enables you to connect your UART devices, with each channel functioning
as a virtual UART bus for the connected component.</p>
<p>The I/O pins of the WeiKai chips can be use as any of the other GPIO pins.
Any option accepting a <a class="reference internal" href="../guides/configuration-types.html#config-pin-schema"><span class="std std-ref">Pin Schema</span></a> can theoretically
be used, but some more complicated components that do communication through
this I/O expander might not work.</p>
<section id="connecting-via-an-spi-bus">
<h2>Connecting via an SPI bus<a class="headerlink" href="#connecting-via-an-spi-bus" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">wk2132_spi</span></code>, <code class="docutils literal notranslate"><span class="pre">wk2212_spi</span></code>, <code class="docutils literal notranslate"><span class="pre">wk2204_spi</span></code>, <code class="docutils literal notranslate"><span class="pre">wk2168_spi</span></code> components allows
you to connect the WeiKai chip with ESPHome via a <a class="reference internal" href="spi.html#spi"><span class="std std-ref">SPI</span></a> bus.</p>
<p>You can connect several of these modules to a single SPI controller circuit effectively expanding
the number of hardware serial ports available. Each WeiKai chip needs to be selected
with a individual CS.</p>
<p>Here is an example of configuration entry for a wk2168_spi component. For the other components
in the list just replace the name of the component and make sure you do not use more channels that the chip
can support (an error message will be generated otherwise). Note that for the <code class="docutils literal notranslate"><span class="pre">WK2124-ISSG</span></code> chip
you need to use <code class="docutils literal notranslate"><span class="pre">wk2204_spi</span></code> as the two chips are similar.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">wk2168_spi</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wk2168_bridge_spi</span>
<span class="w">    </span><span class="nt">cs_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">uart</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spi_uart_0</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">        </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128200</span>
<span class="w">        </span><span class="nt">parity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">even</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spi_uart_1</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">19200</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spi_uart_2</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">        </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9600</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spi_uart_3</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">        </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">19200</span>
</pre></div>
</div>
<section id="configuration-variables">
<h3>Configuration variables:<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>id</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): The id to use for this WeiKai component.</p></li>
<li><p><strong>spi_id</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID of the <a class="reference internal" href="spi.html#spi"><span class="std std-ref">SPI Component</span></a> if you want
to use multiple SPI buses.</p></li>
<li><p><strong>cs_pin</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-pin-schema"><span class="std std-ref">Pin Schema</span></a>): The pin on the ESP that the chip select line
of the chip is connected to.</p></li>
<li><p><strong>data_rate</strong> (<em>Optional</em>): Set the data rate of the controller. One of <code class="docutils literal notranslate"><span class="pre">80MHz</span></code>, <code class="docutils literal notranslate"><span class="pre">40MHz</span></code>, <code class="docutils literal notranslate"><span class="pre">20MHz</span></code>, <code class="docutils literal notranslate"><span class="pre">10MHz</span></code>,
<code class="docutils literal notranslate"><span class="pre">5MHz</span></code>, <code class="docutils literal notranslate"><span class="pre">4MHz</span></code>, <code class="docutils literal notranslate"><span class="pre">2MHz</span></code>, <code class="docutils literal notranslate"><span class="pre">1MHz</span></code> (default), <code class="docutils literal notranslate"><span class="pre">200kHz</span></code>, <code class="docutils literal notranslate"><span class="pre">75kHz</span></code> or <code class="docutils literal notranslate"><span class="pre">1kHz</span></code>. A numeric value in Hz can
alternatively be specified.</p></li>
<li><p><strong>crystal</strong> (<em>Optional</em>): The frequency in Hz of the crystal connected to the chip.
The default value is 14745600 Hz.</p></li>
<li><p><strong>uart</strong> (<strong>Required</strong>): The UART channels.</p>
<ul>
<li><p><strong>id</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): The id to use for this UART channel.</p></li>
<li><p><strong>channel</strong> (<strong>Required</strong>): Unique channel number of this virtual UART.
Options: <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">3</span></code> depending on the model.</p></li>
<li><p><strong>baud_rate</strong> (<strong>Required</strong>): The baud rate of the UART channel.</p></li>
<li><p><strong>parity</strong> (<em>Optional</em>): The parity used on the UART channel. Options: <code class="docutils literal notranslate"><span class="pre">NONE</span></code>, <code class="docutils literal notranslate"><span class="pre">EVEN</span></code>,
<code class="docutils literal notranslate"><span class="pre">ODD</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">NONE</span></code>.</p></li>
<li><p><strong>stop_bits</strong> (<em>Optional</em>): The number of stop bits to send. Options: <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="connecting-via-an-i2c-bus">
<h2>Connecting via an I²C bus<a class="headerlink" href="#connecting-via-an-i2c-bus" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">wk2132_i2c</span></code> <code class="docutils literal notranslate"><span class="pre">wk2212_i2c</span></code> <code class="docutils literal notranslate"><span class="pre">wk2204_i2c</span></code> <code class="docutils literal notranslate"><span class="pre">wk2168_i2c</span></code> components allows you
to connect the WeiKai chip with ESPHome via an <a class="reference internal" href="i2c.html#i2c"><span class="std std-ref">I²C</span></a> bus.
Up to four WeiKai chips can be connected to an I²C controller board, effectively expanding the
available hardware serial ports. The base addresses of these boards are defined by the
positions of two switches, A0 and A1, on the board.</p>
<table class="docutils align-center" id="id3" style="width: 350px">
<caption><span class="caption-text">WeiKai address selection</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>I²C address</p></th>
<th class="head"><p>A1</p></th>
<th class="head"><p>A0</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x10 - 0x17</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>0x30 - 0x37</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>0x50 - 0x57</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>0x70 - 0x77</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Note that the address is given as a <strong>range</strong> a not a number as you usually find on other I²C component.
Indeed due to a peculiar way of addressing the different internal registers each component actually occupy
8 consecutive addresses. For example if the component base address is 0x10, it will occupy the addresses ranging from
0x10 to 0x17 on the I²C bus.</p>
<p>This is important to know if you want to connect other devices on the same I²C bus.</p>
</div>
<p>Here is an example of configuration entry for a <code class="docutils literal notranslate"><span class="pre">wk2168_i2c</span></code> component. For the other components
just replace the name of the component and do not use more channels that the chip can
support (an error message will be generated in this case).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">wk2168_i2c</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x70</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wk2168_bridge_i2c</span>
<span class="w">    </span><span class="nt">uart</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">i2c_uart_0</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">        </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9600</span>
<span class="w">        </span><span class="nt">parity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">even</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">i2c_uart_1</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">19200</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">i2c_uart_2</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">        </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9600</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">i2c_uart_3</span>
<span class="w">        </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">        </span><span class="nt">baud_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">19200</span>
</pre></div>
</div>
<section id="id1">
<h3>Configuration variables:<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>id</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): The id to use for this WeiKai component.</p></li>
<li><p><strong>address</strong> (<em>Optional</em>): The I²C address of this component. Defaults to <code class="docutils literal notranslate"><span class="pre">0x10</span></code>.</p></li>
<li><p><strong>i2c_id</strong> (<em>Optional</em>): The I²C Bus ID. Defaults to the default i²c bus.</p></li>
<li><p><strong>crystal</strong> (<em>Optional</em>): The frequency in Hz of the crystal connected to the chip.
The default value is 14745600 Hz.</p></li>
<li><p><strong>uart</strong> (<em>Required</em>): The UART channels.</p>
<ul>
<li><p><strong>id</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): The id to use for this UART channel.</p></li>
<li><p><strong>channel</strong> (<strong>Required</strong>): Unique channel number of this virtual UART.
Options: <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">3</span></code> depending on the model.</p></li>
<li><p><strong>baud_rate</strong> (<strong>Required</strong>): The baud rate of the UART channel.</p></li>
<li><p><strong>parity</strong> (<em>Optional</em>): The parity used on the UART channel. Options: <code class="docutils literal notranslate"><span class="pre">NONE</span></code>, <code class="docutils literal notranslate"><span class="pre">EVEN</span></code>,
<code class="docutils literal notranslate"><span class="pre">ODD</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">NONE</span></code>.</p></li>
<li><p><strong>stop_bits</strong> (<em>Optional</em>): The number of stop bits to send. Options: <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="using-the-gpio-pins">
<h2>Using the GPIO pins<a class="headerlink" href="#using-the-gpio-pins" title="Permalink to this heading">¶</a></h2>
<p>For the <code class="docutils literal notranslate"><span class="pre">WK2212</span></code>, and <code class="docutils literal notranslate"><span class="pre">WK2168</span></code> it is possible to use the chip I/O pins as any of the other GPIO pins.
For example for a wk2168_spi chip:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># individual binary_sensor inputs</span>
<span class="nt">binary_sensor</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pin_0&quot;</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span>
<span class="w">      </span><span class="nt">wk2168_spi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wk2168_bridge_spi</span>
<span class="w">      </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span>
<span class="w">        </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pin_1&quot;</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span>
<span class="w">      </span><span class="nt">wk2168_spi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wk2168_bridge_spi</span>
<span class="w">      </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span>
<span class="w">        </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">inverted</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1"># Individual binary outputs</span>
<span class="nt">switch</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pin_2&quot;</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span>
<span class="w">      </span><span class="nt">wk2168_spi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wk2168_bridge_spi</span>
<span class="w">      </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span>
<span class="w">        </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pin_3&quot;</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span>
<span class="w">      </span><span class="nt">wk2168_spi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wk2168_bridge_spi</span>
<span class="w">      </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">      </span><span class="nt">mode</span><span class="p">:</span>
<span class="w">        </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">inverted</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<section id="pin-configuration-variables">
<h3>Pin configuration variables:<a class="headerlink" href="#pin-configuration-variables" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>wkxxxx_xxx</strong> (<strong>Required</strong>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): The id of the <code class="docutils literal notranslate"><span class="pre">wkxxxx_xxx</span></code> component for the pin. For
example <code class="docutils literal notranslate"><span class="pre">wk2212_i2c:</span> <span class="pre">wk2168_bridge_spi</span></code></p></li>
<li><p><strong>number</strong> (<strong>Required</strong>): The pin number (<code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">7</span></code>)</p></li>
<li><p><strong>inverted</strong> (<em>Optional</em>): If all read and written values should be treated as inverted. Defaults to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><strong>mode</strong> (<em>Optional</em>): A pin mode to set for the pin at. One of <code class="docutils literal notranslate"><span class="pre">INPUT</span></code> or <code class="docutils literal notranslate"><span class="pre">OUTPUT</span></code>. Default to <code class="docutils literal notranslate"><span class="pre">INPUT</span></code></p></li>
</ul>
</section>
</section>
<section id="performance-considerations">
<h2>Performance considerations:<a class="headerlink" href="#performance-considerations" title="Permalink to this heading">¶</a></h2>
<section id="bus-speed">
<h3>Bus speed<a class="headerlink" href="#bus-speed" title="Permalink to this heading">¶</a></h3>
<p>Please be aware that the communication between the WeiKai chips and the processor occurs on an external bus,
with a relatively low operating frequency. Therefore tasks such as checking the status of the chip’s
registers or transferring bytes from the internal FIFOs to the processor may take time.</p>
<p>To improve this situation, it is strongly recommended to increase the default bus frequency.</p>
<ul class="simple">
<li><p>With a SPI bus this can be done on the WeiKai component by specifying <code class="docutils literal notranslate"><span class="pre">data_rate</span></code>. For example:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">wk2168_spi</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wk2168_bridge_spi</span>
<span class="w">    </span><span class="nt">spi_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spi_bus_id</span>
<span class="w">    </span><span class="nt">cs_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">data_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4MHz</span>
</pre></div>
</div>
<ul class="simple">
<li><p>With an I²C bus this needs to be done on the <code class="docutils literal notranslate"><span class="pre">i2c</span></code> declaration and therefore this frequency will
apply to all components connected to this bus.</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">i2c</span><span class="p">:</span>
<span class="w">  </span><span class="nt">sda</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">21</span>
<span class="w">  </span><span class="nt">scl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22</span>
<span class="w">  </span><span class="nt">scan</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bus_i2c</span>
<span class="w">  </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">800kHz</span>
</pre></div>
</div>
</section>
<section id="maximum-baud-rate">
<h3>Maximum Baud rate<a class="headerlink" href="#maximum-baud-rate" title="Permalink to this heading">¶</a></h3>
<p>The maximum baud_rate is proportional to the crystal frequency. The following table
gives the maximum baud_rate at usual system clock:</p>
<table class="docutils align-center" id="id4" style="width: 300px">
<caption><span class="caption-text">maximum baud rate</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Clock</p></th>
<th class="head"><p>Max Bd</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>14,745,600 Hz</p></td>
<td><p>921,600 Bd</p></td>
</tr>
<tr class="row-odd"><td><p>11,059,200 Hz</p></td>
<td><p>691,200 Bd</p></td>
</tr>
<tr class="row-even"><td><p>7,372,800 Hz</p></td>
<td><p>460,800 Bd</p></td>
</tr>
<tr class="row-odd"><td><p>3,686,400 Hz</p></td>
<td><p>230,400 Bd</p></td>
</tr>
<tr class="row-even"><td><p>1,843,200 Hz</p></td>
<td><p>115,200 Bd</p></td>
</tr>
</tbody>
</table>
<p>If you try to use a baud  rate superior to the maximum baud_rate an error will be displayed in the
log file and the baud rate will automatically be decreased.</p>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="i2c.html#i2c"><span class="std std-ref">I²C Bus</span></a></p></li>
<li><p><a class="reference internal" href="spi.html#spi"><span class="std std-ref">SPI Bus</span></a></p></li>
<li><p><a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO Switch</span></a></p></li>
<li><p><a class="reference internal" href="binary_sensor/gpio.html"><span class="doc">GPIO Binary Sensor</span></a></p></li>
<li><p><a class="reference external" href="/api/weika_8h.html">API Reference</a></p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/weikai.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been released since you last visited this page: 2024.5.4 🎉
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2024.5.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2024.5");
    } else if (old !== "2024.5") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2024.5");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>