
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions to setup WireGuard for your ESP board.">
<meta name="keywords" content="WireGuard, VPN">
<meta itemprop="name" content="WireGuard Component">
<meta itemprop="description" content="Instructions to setup WireGuard for your ESP board.">
<meta name="twitter:title" content="WireGuard Component">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions to setup WireGuard for your ESP board.">
<meta property="og:title" content="WireGuard Component">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions to setup WireGuard for your ESP board.">

    <title>WireGuard Component &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/wireguard.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="XL9535 I/O Expander" href="xl9535.html" />
    <link rel="prev" title="WiFi Component" href="wifi.html" />
  <link href="/pagefind/pagefind-modular-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="../_static/custom.css?hash=573f3103" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <link rel="me" href="https://fosstodon.org/@esphome">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo-text.svg" alt="Logo"/>
            </a></p><script src="/pagefind/pagefind-modular-ui.js"></script>
<div class="pagefind-ui__form" id="search"></div>
<div class="search-results" id="mobile-search-results"></div>
<script>
    let callbackAdded = null;

    window.addEventListener('DOMContentLoaded', (event) => {
        const std_target = document.getElementById("search-results");
        const mobile_target = document.getElementById("mobile-search-results");
        const inpel = document.getElementById("search");

        function showTarget() {
            var target = std_target;
            if (window.innerWidth <= 875) {
                target = mobile_target;
                std_target.style.display = "none";
            } else {
                mobile_target.style.display = "none";
            }
            target.style.display = "block";
            const rect = target.getBoundingClientRect();
            const height = window.innerHeight;
            target.style.width = "100%";
            target.style.height = "fit-content";
            target.style.maxHeight = (height - rect.top - 10) + "px";
            if (!callbackAdded) {
                callbackAdded = true;
                document.addEventListener('click', clickCallback);
            }
        }

        function hideTargets() {
            std_target.style.display = "none";
            mobile_target.style.display = "none";
            std_target.style.height = "0";
            mobile_target.style.height = "0";
            if (callbackAdded) {
                document.removeEventListener('click', clickCallback);
                callbackAdded = false;
            }
        }


        const instance = new PagefindModularUI.Instance({
            showSubResults: true,
            showImages: false,
            ranking: {
                pageLength: 0.0,
                termSaturation: 1.6,
                termFrequency: 0.4,
                termSimilarity: 6.0
            }
        });

        instance.add(new PagefindModularUI.Input({
            containerElement: "#search"
        }));

        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#search-results"
        }));
        instance.add(new PagefindModularUI.ResultList({
            containerElement: "#mobile-search-results"
        }));

        const clickCallback = (event) => {
            const path = event.composedPath();
            if (path.includes(std_target) || path.includes(mobile_target) || path.includes(inpel))
                return;
            hideTargets();
        };
        if (std_target && mobile_target) {
            instance.on("results", (results) => {
                if (results.results.length) {
                    showTarget();
                } else {
                    hideTargets();
                }
            });
        }
    });
</script>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">WireGuard Component</a><ul>
<li><a class="reference internal" href="#configuration-variables">Configuration variables</a></li>
<li><a class="reference internal" href="#static-routes-and-outgoing-connections">Static routes and outgoing connections</a></li>
<li><a class="reference internal" href="#sensors">Sensors</a><ul>
<li><a class="reference internal" href="#status-binary-sensor">Status Binary Sensor</a></li>
<li><a class="reference internal" href="#enabled-binary-sensor">Enabled Binary Sensor</a></li>
<li><a class="reference internal" href="#latest-handshake-sensor">Latest Handshake Sensor</a></li>
<li><a class="reference internal" href="#address-text-sensor">Address Text Sensor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actions">Actions</a><ul>
<li><a class="reference internal" href="#wireguard-disable"><code class="docutils literal notranslate"><span class="pre">wireguard.disable</span></code></a></li>
<li><a class="reference internal" href="#wireguard-enable"><code class="docutils literal notranslate"><span class="pre">wireguard.enable</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#conditions">Conditions</a><ul>
<li><a class="reference internal" href="#wireguard-enabled"><code class="docutils literal notranslate"><span class="pre">wireguard.enabled</span></code></a></li>
<li><a class="reference internal" href="#wireguard-peer-online"><code class="docutils literal notranslate"><span class="pre">wireguard.peer_online</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#remote-peer-setup">Remote peer setup</a></li>
<li><a class="reference internal" href="#connecting-to-remote-home-assistant">Connecting to remote Home Assistant</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  <ul class="breadcrumbs">
  
      <li><a href="index.html">Components</a> ➔</li>
      <li>WireGuard Component</li>

  
  </ul>
  <div class="search-results" id="search-results"></div>


          <div class="body" role="main">
            
  <section id="wireguard-component">
<h1>WireGuard Component<a class="headerlink" href="#wireguard-component" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://www.wireguard.org/">WireGuard®</a> is an extremely simple yet fast and modern VPN that utilizes
state-of-the-art cryptography. This component uses a <strong>custom</strong>
implementation not developed by original authors and currently
available for ESP32 and ESP8266 platforms <em>only</em>.</p>
<blockquote>
<div><p>Please note that <em>“WireGuard” and the “WireGuard” logo are
registered trademarks of Jason A. Donenfeld.</em> See
<a class="reference external" href="https://www.wireguard.com/trademark-policy/">“WireGuard” Trademark Usage Policy</a>
for additional information.</p>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To successfully use this component you must have WireGuard® also
on your remote host (already installed and ready to accept connections).
If you don’t have it please read the section <a class="reference internal" href="#wireguard-installation"><span class="std std-ref">Remote peer setup</span></a>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This component requires the system clock to be synchronized.</p>
<p>See <a class="reference internal" href="time/index.html"><span class="doc">Time Component</span></a> to setup a time source
and <strong>do not use</strong> <code class="docutils literal notranslate"><span class="pre">homeassistant</span></code> time-platform if
Home Assistant is on the remote peer because the time
synchronization is a prerequisite to establish the VPN link.</p>
<p>The <a class="reference internal" href="time/sntp.html"><span class="doc">SNTP Time Source</span></a> is a valid time-platform choice.</p>
</div>
<p>A VPN tunnel can be created to a <strong>single</strong> remote peer
adding the following to your configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example configuration entry</span>
<span class="nt">wireguard</span><span class="p">:</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x.y.z.w</span>
<span class="w">  </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AaBbCcDd...=</span>
<span class="w">  </span><span class="nt">peer_endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wg.server.example</span>
<span class="w">  </span><span class="nt">peer_public_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EeFfGgHh...=</span>

<span class="w">  </span><span class="c1"># Optional netmask (this is the default, no outgoing traffic</span>
<span class="w">  </span><span class="c1"># will pass through the tunnel if omitted)</span>
<span class="w">  </span><span class="nt">netmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255.255.255.255</span>

<span class="w">  </span><span class="c1"># Optional endpoint port (WireGuard default if omitted)</span>
<span class="w">  </span><span class="nt">peer_port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">51820</span>

<span class="w">  </span><span class="c1"># Optional pre-shared key (omit if not in use)</span>
<span class="w">  </span><span class="nt">peer_preshared_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">XxYyZzWw...=</span>

<span class="w">  </span><span class="c1"># Optional list of ip/mask (any host is allowed if omitted)</span>
<span class="w">  </span><span class="nt">peer_allowed_ips</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x.y.z.0/24</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l.m.n.o/32</span><span class="w">  </span><span class="c1"># the /32 can be omitted for single host</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="c1"># Optional keepalive (disabled by default)</span>
<span class="w">  </span><span class="nt">peer_persistent_keepalive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25s</span>
</pre></div>
</div>
<p>It is recommended to use <em>secrets</em> at least for private and pre-shared keys:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">wireguard</span><span class="p">:</span>
<span class="w">  </span><span class="nt">private_key</span><span class="p">:</span><span class="w"> </span><span class="kt">!secret</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wg_privkey</span>
<span class="w">  </span><span class="nt">peer_preshared_key</span><span class="p">:</span><span class="w"> </span><span class="kt">!secret</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wg_shrdkey</span>
</pre></div>
</div>
<section id="configuration-variables">
<h2>Configuration variables<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">¶</a></h2>
<ul id="wireguard-address">
<li><p><strong>address</strong> (<strong>Required</strong>, IPv4 address): The local VPN address of the device.</p>
<p>If you intend to upload firmwares through the VPN link you probably need
to copy this value to the <code class="docutils literal notranslate"><span class="pre">use_address</span></code> parameter of the <a class="reference internal" href="wifi.html"><span class="doc">WiFi Component</span></a>.</p>
</li>
<li><p><strong>netmask</strong> (<em>Optional</em>, IPv4 address): The netmask for the configured address.
Default to <code class="docutils literal notranslate"><span class="pre">255.255.255.255</span></code>.</p>
<p>See section <a class="reference internal" href="#wireguard-static-routes"><span class="std std-ref">Static routes and outgoing connections</span></a> if outgoing connections are
expected to transit through the VPN link (e.g. with <a class="reference internal" href="mqtt.html"><span class="doc">MQTT Client Component</span></a> to a
remote MQTT broker).</p>
</li>
<li><p><strong>private_key</strong> (<strong>Required</strong>, string): The private key of the device.</p></li>
<li><p><strong>peer_endpoint</strong> (<strong>Required</strong>, string): The hostname of the remote peer.</p></li>
<li><p><strong>peer_port</strong> (<em>Optional</em>, UDP port): The port where remote peer is listening on.
The WireGuard® default is <code class="docutils literal notranslate"><span class="pre">51820</span></code>.</p></li>
<li><p><strong>peer_public_key</strong> (<strong>Required</strong>, string): The public key of the remote peer.</p></li>
<li><p><strong>peer_preshared_key</strong> (<em>Optional</em>, string): The chosen pre-shared key between
local device and remote peer.</p></li>
<li><p><strong>peer_persistent_keepalive</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The amount of
time after which a <em>keepalive</em> packet is sent through the tunnel.
By default this feature is disabled (<code class="docutils literal notranslate"><span class="pre">0s</span></code>).</p>
<p>If there are NATs or firewalls between the device and the remote peer set
this value to something like <code class="docutils literal notranslate"><span class="pre">25s</span></code>.</p>
</li>
<li><p><strong>peer_allowed_ips</strong> (<em>Optional</em>, list of IPv4 networks): A list of networks
in CIDR notation (<em>IP/mask</em>) to be allowed through the tunnel. Any host
(<code class="docutils literal notranslate"><span class="pre">0.0.0.0/0</span></code>) will be allowed if this parameter is omitted.</p>
<p>The device own <code class="docutils literal notranslate"><span class="pre">address/32</span></code> is always added by default to this list.</p>
<p>See section <a class="reference internal" href="#wireguard-static-routes"><span class="std std-ref">Static routes and outgoing connections</span></a> if outgoing connections are
expected to transit through the VPN link (e.g. with <a class="reference internal" href="mqtt.html"><span class="doc">MQTT Client Component</span></a> to a
remote MQTT broker).</p>
</li>
<li><p><strong>reboot_timeout</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The amount of time to wait
before rebooting the device when the remote peer is unreachable. Can be disabled
by setting this to <code class="docutils literal notranslate"><span class="pre">0s</span></code>. Default to <code class="docutils literal notranslate"><span class="pre">15min</span></code>.</p></li>
<li><p><strong>require_connection_to_proceed</strong> (<em>Optional</em>, boolean): Set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to
wait for the remote peer to be up before continuing to boot the device.
Default to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>This can be used to delay the initialization of components that use the
VPN tunnel as long as the VPN isn’t ready. For example if you are using
<a class="reference internal" href="mqtt.html"><span class="doc">MQTT Client Component</span></a> to reach a remote broker you may experience boot freeze just
after the setup of MQTT because it waits for the broker to be reachable,
but the connection cannot be established until the VPN link is
active too. To bypass such deadlock set this parameter to <code class="docutils literal notranslate"><span class="pre">true</span></code> in
order to not initialize MQTT until the remote peer is up.</p>
</li>
<li><p><strong>update_interval</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): How often to check
the connection status and the latest handshake value. Default to <code class="docutils literal notranslate"><span class="pre">10s</span></code>.</p></li>
<li><p><strong>id</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID used for code generation.</p></li>
</ul>
</section>
<section id="static-routes-and-outgoing-connections">
<span id="wireguard-static-routes"></span><h2>Static routes and outgoing connections<a class="headerlink" href="#static-routes-and-outgoing-connections" title="Permalink to this heading">¶</a></h2>
<p>Currently there is no way on ESP devices to configure static routes for
network interfaces, so the <code class="docutils literal notranslate"><span class="pre">peer_allowed_ips</span></code> list is used only to allow
(or drop) packets that pass through the VPN tunnel, not to define static
routes for remote hosts.</p>
<p>The routes are implicitly added by the configured <code class="docutils literal notranslate"><span class="pre">netmask</span></code> and
<strong>only</strong> packets with destination <em>inside</em> the same network defined
by <code class="docutils literal notranslate"><span class="pre">address/netmask</span></code> will be routed to the tunnel.</p>
<p>This means that the user has to tweak the <code class="docutils literal notranslate"><span class="pre">netmask</span></code> parameter
to “cover” <strong>all</strong> the networks in the allowed IPs list in order
to successfully establish <em>outgoing</em> connections to remote hosts.
Incoming connections are not affected by <code class="docutils literal notranslate"><span class="pre">netmask</span></code>.</p>
<p>Let’s explain with some examples:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>address</p></th>
<th class="head"><p>netmask</p></th>
<th class="head"><p>allowed ips</p></th>
<th class="head"><p>working outgoing connections</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>172.16.0.100</p></td>
<td><p><em>omitted</em> or
255.255.255.255</p></td>
<td><p><em>omitted</em> or
any other value</p></td>
<td><p><strong>none</strong>,
no routes are created</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>255.255.255.0</p></td>
<td><p><em>omitted</em></p></td>
<td rowspan="2"><p>only to <code class="docutils literal notranslate"><span class="pre">172.16.0.0/24</span></code>
because <code class="docutils literal notranslate"><span class="pre">192.168.0.0/24</span></code>
and any other network will
be outside <code class="docutils literal notranslate"><span class="pre">172.16.0.0/24</span></code></p></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li><p>172.16.0.0/24</p></li>
<li><p>192.168.0.0/24</p></li>
<li><p><em>any other</em></p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>192.168.0.0/24</p></li>
</ul>
</td>
<td><p><strong>none</strong> because
<code class="docutils literal notranslate"><span class="pre">192.168.0.0/24</span></code> is not
part of <code class="docutils literal notranslate"><span class="pre">172.16.0.0/24</span></code></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>10.44.0.100</p></td>
<td rowspan="2"><p>255.0.0.0</p></td>
<td><p><em>omitted</em></p></td>
<td><p>to <code class="docutils literal notranslate"><span class="pre">10.0.0.0/8</span></code> network</p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>10.44.0.0/16</p></li>
<li><p>10.10.0.0/16</p></li>
</ul>
</td>
<td><p>only to the networks in
the allowed list because the
netmask will route the whole
<code class="docutils literal notranslate"><span class="pre">10.0.0.0/8</span></code> but wireguard
allows only those two
subnets</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>any</p></td>
<td rowspan="2"><p>0.0.0.0</p></td>
<td><p><em>omitted</em></p></td>
<td><p><strong>any</strong></p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>172.16.0.0/24</p></li>
<li><p>10.44.0.0/16</p></li>
<li><p>10.10.0.0/16</p></li>
</ul>
</td>
<td><p>to any network that is in
the list of allowed IPs
because the netmask will
route any traffic but
wireguard allows only its
own list</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting the <code class="docutils literal notranslate"><span class="pre">netmask</span></code> to <code class="docutils literal notranslate"><span class="pre">0.0.0.0</span></code> has the effect of routing
through the VPN link any traffic. It is like having set the wireguard
interface as the system default.</p>
</div>
</section>
<section id="sensors">
<span id="wireguard-sensors"></span><h2>Sensors<a class="headerlink" href="#sensors" title="Permalink to this heading">¶</a></h2>
<p>Here after the sensors available for this component.</p>
<section id="status-binary-sensor">
<h3>Status Binary Sensor<a class="headerlink" href="#status-binary-sensor" title="Permalink to this heading">¶</a></h3>
<p>This binary sensor tracks the connection status (<em>online</em>/<em>offline</em>) of the remote peer.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example configuration entry</span>
<span class="nt">binary_sensor</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireguard</span>
<span class="w">    </span><span class="nt">status</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;WireGuard</span><span class="nv"> </span><span class="s">Status&#39;</span>
</pre></div>
</div>
<p>All options from <a class="reference internal" href="binary_sensor/index.html#config-binary-sensor"><span class="std std-ref">Binary Sensor</span></a> can be added to the
above configuration.</p>
</section>
<section id="enabled-binary-sensor">
<h3>Enabled Binary Sensor<a class="headerlink" href="#enabled-binary-sensor" title="Permalink to this heading">¶</a></h3>
<p>This binary sensor tracks if WireGuard® is <em>enabled</em> or not.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example configuration entry</span>
<span class="nt">binary_sensor</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireguard</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;WireGuard</span><span class="nv"> </span><span class="s">Enabled&#39;</span>
</pre></div>
</div>
<p>All options from <a class="reference internal" href="binary_sensor/index.html#config-binary-sensor"><span class="std std-ref">Binary Sensor</span></a> can be added to the
above configuration.</p>
</section>
<section id="latest-handshake-sensor">
<h3>Latest Handshake Sensor<a class="headerlink" href="#latest-handshake-sensor" title="Permalink to this heading">¶</a></h3>
<p>This sensor reports the <em>timestamp</em> of the latest completed handshake.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example configuration entry</span>
<span class="nt">sensor</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireguard</span>
<span class="w">    </span><span class="nt">latest_handshake</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;WireGuard</span><span class="nv"> </span><span class="s">Latest</span><span class="nv"> </span><span class="s">Handshake&#39;</span>
</pre></div>
</div>
<p>All options from <a class="reference internal" href="sensor/index.html#config-sensor"><span class="std std-ref">Sensor</span></a> can be added to the
above configuration.</p>
</section>
<section id="address-text-sensor">
<h3>Address Text Sensor<a class="headerlink" href="#address-text-sensor" title="Permalink to this heading">¶</a></h3>
<p>This sensor exposes to the frontend the configured <a class="reference internal" href="#wireguard-address"><span class="std std-ref">address</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example configuration entry</span>
<span class="nt">text_sensor</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireguard</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;WireGuard</span><span class="nv"> </span><span class="s">Address&#39;</span>
</pre></div>
</div>
<p>All options from <a class="reference internal" href="text_sensor/index.html#config-text-sensor"><span class="std std-ref">Text Sensor</span></a> can be added to the
above configuration.</p>
</section>
</section>
<section id="actions">
<span id="wireguard-actions"></span><h2>Actions<a class="headerlink" href="#actions" title="Permalink to this heading">¶</a></h2>
<p>The following actions are available.</p>
<section id="wireguard-disable">
<h3><code class="docutils literal notranslate"><span class="pre">wireguard.disable</span></code><a class="headerlink" href="#wireguard-disable" title="Permalink to this heading">¶</a></h3>
<p>This action drops down the active VPN link (if any) and disables the component.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">wireguard.disable</span><span class="p">:</span>
</pre></div>
</div>
<p>The lambda equivalent is <code class="docutils literal notranslate"><span class="pre">id(wireguard_id).disable()</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To disable WireGuard® since device boot you can execute this action
in the <a class="reference internal" href="esphome.html#esphome-on-boot"><span class="std std-ref">on_boot</span></a> step.</p>
</div>
</section>
<section id="wireguard-enable">
<h3><code class="docutils literal notranslate"><span class="pre">wireguard.enable</span></code><a class="headerlink" href="#wireguard-enable" title="Permalink to this heading">¶</a></h3>
<p>This action enables the component and starts the connection to the remote peer.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">wireguard.enable</span><span class="p">:</span>
</pre></div>
</div>
<p>The lambda equivalent is <code class="docutils literal notranslate"><span class="pre">id(wireguard_id).enable()</span></code>.</p>
</section>
</section>
<section id="conditions">
<span id="wireguard-conditions"></span><h2>Conditions<a class="headerlink" href="#conditions" title="Permalink to this heading">¶</a></h2>
<p>The following conditions are available.</p>
<section id="wireguard-enabled">
<h3><code class="docutils literal notranslate"><span class="pre">wireguard.enabled</span></code><a class="headerlink" href="#wireguard-enabled" title="Permalink to this heading">¶</a></h3>
<p>This condition checks if WireGuard® is currently enabled or not.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span>
<span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireguard.enabled</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">      </span><span class="nt">else</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>The lambda equivalent is <code class="docutils literal notranslate"><span class="pre">id(wireguard_id).is_enabled()</span></code>.</p>
</section>
<section id="wireguard-peer-online">
<h3><code class="docutils literal notranslate"><span class="pre">wireguard.peer_online</span></code><a class="headerlink" href="#wireguard-peer-online" title="Permalink to this heading">¶</a></h3>
<p>This condition checks if the remote peer is <em>online</em>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span>
<span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireguard.peer_online</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">      </span><span class="nt">else</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>The lambda equivalent is <code class="docutils literal notranslate"><span class="pre">id(wireguard_id).is_peer_up()</span></code>.</p>
</section>
</section>
<section id="remote-peer-setup">
<span id="wireguard-installation"></span><h2>Remote peer setup<a class="headerlink" href="#remote-peer-setup" title="Permalink to this heading">¶</a></h2>
<p>There are many different ways for installing and configuring
WireGuard® on servers, home servers or general host. It depends
on the platform and on the operating system in use.</p>
<p>You can start reading the <a class="reference external" href="https://www.wireguard.com/">official documentation</a>
to have an overview of what it is and on how to install it <em>system wide</em> for
common operating systems. Read the thread at <a class="reference external" href="https://community.home-assistant.io/t/home-assistant-community-add-on-wireguard/134662">Home Assistant Community Add-on: WireGuard</a>
if you intend to install it through Home Assistant. Plase note that securely
setting up a VPN requires some networking experience, you will need to open
router ports and possibly use custom commands to redirect traffic.</p>
<p>Once everything is configured you should be able to add the device
to Home Assistant. See next section.</p>
</section>
<section id="connecting-to-remote-home-assistant">
<h2>Connecting to remote Home Assistant<a class="headerlink" href="#connecting-to-remote-home-assistant" title="Permalink to this heading">¶</a></h2>
<p>The ESP device should interact with remote Home Assistant, across the VPN link,
as it is on the local network but probably the initial <em>auto discovery</em>
will not work and you have to add the device <strong>manually</strong>.</p>
<p>These are the steps:</p>
<ol class="arabic simple">
<li><p>go to the Home Assistant “Integrations” page</p></li>
<li><p>click on the “Add Integration” button (bottom right corner)</p></li>
<li><p>select “ESPHome” from the list</p></li>
<li><p>insert the configured IP <a class="reference internal" href="#wireguard-address"><span class="std std-ref">address</span></a>
as the host name</p></li>
</ol>
<p>The device should now be linked to your remote Home Assistant.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have issues linking the ESP device try setting
the <code class="docutils literal notranslate"><span class="pre">use_address</span></code> parameter of the <a class="reference internal" href="wifi.html"><span class="doc">WiFi Component</span></a> to the value
of the <a class="reference internal" href="#wireguard-address"><span class="std std-ref">address</span></a> configured here.</p>
</div>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="time/index.html"><span class="doc">Time Component</span></a></p></li>
<li><p><a class="reference internal" href="time/sntp.html"><span class="doc">SNTP Time Source</span></a></p></li>
<li><p><a class="reference internal" href="../guides/automations.html#automation"><span class="std std-ref">Automations and Templates</span></a></p></li>
<li><p><a class="reference external" href="https://www.wireguard.org/">WireGuard®</a> official website</p></li>
<li><p><a class="reference external" href="https://community.home-assistant.io/t/home-assistant-community-add-on-wireguard/134662">Home Assistant Community Add-on: WireGuard</a>
(also on <a class="reference external" href="https://github.com/hassio-addons/addon-wireguard">GitHub</a>)</p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/wireguard.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been released since you last visited this page: 2024.5.4 🎉
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2024.5.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2024.5");
    } else if (old !== "2024.5") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2024.5");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>